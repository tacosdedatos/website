<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Primeros pasos con ggplot (R) y Altair (Python) - Parte II</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />
    <!-- <link rel="stylesheet" type="text/css" href="/assets/built/prism.css" /> -->
    <!-- highlight.js -->
    <!-- <link rel="stylesheet" href="/assets/built/styles/default.css"> -->
    <style>.hljs { background: none; }</style>
    <!-- night owl style  -->
    <link rel="stylesheet" href="/assets/built/styles/night-owl.css" />
    <style type='text/css'>
        pre, code {
            white-space: pre-wrap;
            overflow-x: scroll;
        }
        .hljs {
            display: inline-block;
            overflow-x: scroll;
            min-width: 100%;
        }
        .highlight {
            min-width: 100%;
        }
        div[class^="language-"] {
            min-width: 100%;
        }
    </style>

    

    



    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Tu sitio para aprender de visualización y ciencia de datos en español. Consejos, recursos y mejores prácticas para tus proyectos de tecnología, periodismo de datos y análisis estadísticos." />
    <link rel="shortcut icon" href="https://old.tacosdedatos.com/assets/icons/favicon.ico" type="image/png" />
    <link rel="canonical" href="https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair-Parte-II" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="🌮 tacos de datos | Aprende visualización de datos en español." />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Primeros pasos con ggplot (R) y Altair (Python) - Parte II" />
    <meta property="og:description" content="Bienvenidos a la segunda y última parte de mi aventura por ggplot y Altair En la entrada anterior les platiqué acerca del reto que decidí hacer (analizar castigos a favor y en contra de la #PatsNation), de cómo hice el dataset y de cómo hice las dos primeras gráficas de" />
    <meta property="og:url" content="https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair-Parte-II" />
    <meta property="og:image" content="https://old.tacosdedatos.com/assets/blogposts/010.png" />
    <meta property="article:publisher" content="https://www.facebook.com/tacosdedatos" />
    <meta property="article:author" content="https://www.facebook.com/tacosdedatos" />
    <meta property="article:published_time" content="2020-01-10T10:00:00+00:00" />
    <meta property="article:modified_time" content="2020-01-10T10:00:00+00:00" />
    <meta property="article:tag" content="Blog" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Primeros pasos con ggplot (R) y Altair (Python) - Parte II" />
    <meta name="twitter:description" content="Bienvenidos a la segunda y última parte de mi aventura por ggplot y Altair En la entrada anterior les platiqué acerca del reto que decidí hacer (analizar castigos a favor y en contra de la #PatsNation), de cómo hice el dataset y de cómo hice las dos primeras gráficas de" />
    <meta name="twitter:url" content="https://old.tacosdedatos.com/" />
    <meta name="twitter:image" content="https://old.tacosdedatos.com/assets/blogposts/010.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="🌮 tacos de datos | Aprende visualización de datos en español." />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Blog" />
    <meta name="twitter:site" content="@tacosdedatos" />
    <meta name="twitter:creator" content="@tacosdedatos" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "🌮 tacos de datos | Aprende visualización de datos en español.",
        "logo": "https://old.tacosdedatos.com/assets/images/alt-blog-icon.png"
    },
    "url": "https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair-Parte-II",
    "image": {
        "@type": "ImageObject",
        "url": "https://old.tacosdedatos.com/assets/blogposts/010.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair-Parte-II"
    },
    "description": "Bienvenidos a la segunda y última parte de mi aventura por ggplot y Altair En la entrada anterior les platiqué acerca del reto que decidí hacer (analizar castigos a favor y en contra de la #PatsNation), de cómo hice el dataset y de cómo hice las dos primeras gráficas de"
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Primeros pasos con ggplot (R) y Altair (Python) - Parte II" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://old.tacosdedatos.com/"><img src="/assets/images/alt-blog-icon.png" alt="🌮 tacos de datos | Aprende visualización de datos en español." /></a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">inicio</a></li>
    <li class="nav-home" role="menuitem"><a href="https://medium.com/tacosdedatos/">la publiqueishon (Medium)</a></li>
    <li class="nav-about" role="menuitem"><a href="/sobre/">sobre 🌮</a></li>
    <li class="nav-podcast" role="menuitem"><a href="https://tacosdedatos.fm">podcast 🌮🎧</a></li>
    <li class="nav-recursos" role="menuitem"><a href="http://boletin.tacosdedatos.com/">el boletín</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-fb" href="https://facebook.com/tacosdedatos" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/tacosdedatos" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Subscríbete</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-blog ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="10 January 2020">10 January 2020</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/blog/'>BLOG</a>,
                            
                        
                            
                               <a href='/tag/altair/'>ALTAIR</a>,
                            
                        
                            
                               <a href='/tag/ggplot2/'>GGPLOT2</a>,
                            
                        
                            
                               <a href='/tag/python/'>PYTHON</a>,
                            
                        
                            
                               <a href='/tag/r/'>R</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Primeros pasos con ggplot (R) y Altair (Python) - Parte II</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/blogposts/010.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>Bienvenidos a la segunda y última parte de mi aventura por <strong>ggplot</strong> y <strong>Altair</strong></p>

<p>En la  <a href="https://tacosdedatos.com/primeros-pasos-con-ggplot-y-altair">entrada anterior</a> les platiqué acerca del reto que decidí hacer (analizar castigos a favor y en contra de la #PatsNation), de cómo hice el dataset y de cómo hice las dos primeras gráficas de barras: una <em>dodge o grouped</em> y una <em>stack</em>.</p>

<p>En este artículo vamos a hacer otras cuantas gráficas, haré mis conclusiones y dejaré algunas recomendaciones para que no pasen el camino de espinas que me tocó recorrer.</p>

<p>Tenga para que se entretenga.</p>

<h2 id="castigos-en-los-últimos-5-min-del-último-cuarto-de-temporada-regular-con-bar-plot-y-mean-lines">Castigos en los últimos 5 min del último cuarto, de temporada regular, con <em>bar plot y mean lines</em></h2>

<p>Si dicen que a los Pats lo ayudan en los minutos cruciales, pensé que sería bueno analizar los castigos que le marcan a los rivales en los últimos 5 minutos del último cuarto. Para esto, decidí analizar las semanas de la temporada regular y las de postemporada.</p>

<p>Las gráficas de semana regular quedaron de la siguiente manera:</p>

<p>R:</p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigoPorSemanasReg.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigoPorSemanasReg.png?raw=true" /></p>

<p>Python:</p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigoPorSemanasReg.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigoPorSemanasReg.png?raw=true" /></p>

<p>Y así es como armé el dataset en ambos casos:</p>

<p>R:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span><span class="w">

</span><span class="c1">#Create column for minute:second in time left</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">mytime</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">strptime</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">time_left_qtr</span><span class="p">,</span><span class="s2">"%M:%S"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">as.ITime</span><span class="p">()</span><span class="w">
</span><span class="n">limit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">strptime</span><span class="p">(</span><span class="s2">"05:00"</span><span class="p">,</span><span class="s2">"%M:%S"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">as.ITime</span><span class="p">()</span><span class="w">

</span><span class="c1">########## CASTIGOS TEMPORADA REGULAR</span><span class="w">
 
  </span><span class="n">df_4q_5min_reg</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">mytime</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">quarter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Q4"</span><span class="p">,</span><span class="w"> 
          </span><span class="n">game_type</span><span class="o">==</span><span class="s1">'REG'</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="w"> </span><span class="o">!=</span><span class="s1">'NE'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">week</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">n</span><span class="p">())</span><span class="w">
</span></code></pre></div></div>

<p>Python:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="c1">#Create column for minute:second in time left
#Esta función pone los minutos como horas y los segundos como minutos. 
#Voy a quedarme sólo con los minutos para ver si son los 5 finales
</span><span class="n">data</span><span class="p">[</span><span class="s">"mytime"</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">"time_left_qtr"</span><span class="p">]).</span><span class="n">dt</span><span class="p">.</span><span class="n">hour</span>
<span class="n">data</span><span class="p">[</span><span class="s">"mytime"</span><span class="p">]</span>

<span class="n">df_4q_5min_reg</span> <span class="o">=</span><span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">.</span><span class="n">mytime</span><span class="o">-</span><span class="mi">5</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="o">&amp;</span> 
     <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">quarter</span> <span class="o">==</span> <span class="s">'Q4'</span><span class="p">)</span> <span class="o">&amp;</span>
     <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">game_type</span><span class="o">==</span><span class="s">'REG'</span><span class="p">)</span> <span class="o">&amp;</span>
     <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">team_penalty_cat</span> <span class="o">!=</span> <span class="s">'NE'</span><span class="p">)].</span><span class="n">groupby</span><span class="p">([</span><span class="s">"week"</span><span class="p">])[</span><span class="s">"week"</span><span class="p">].</span><span class="n">count</span><span class="p">().</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"count"</span><span class="p">)</span>
</code></pre></div></div>
<p>Voy a detenerme un poco en los datasets ya que el manejo del tiempo fue algo interesante en ese ejercicio.</p>

<p>Para <strong>ggplot</strong> usé el comando <code class="language-plaintext highlighter-rouge">strptime</code> para leer la columna <code class="language-plaintext highlighter-rouge">time_left_qtr</code> como formato <code class="language-plaintext highlighter-rouge">%M:%S</code> (minutos y segundos). Después apliqué <code class="language-plaintext highlighter-rouge">as.ITime()</code> para cambiar el tipo de columna. Acto seguido creé una variable <code class="language-plaintext highlighter-rouge">limit</code>usando los comandos anteriores para poder usarla en la condición del dataframe: <code class="language-plaintext highlighter-rouge">difftime(data$mytime, limit) &lt; 0</code>. Lo que la condición valida es que el tiempo en el reloj menos 5 minutos sea menor que cero. Si fuera mayor, no estaría dentro de los últimos 5 minutos.  Esto de jugar con las horas me tomó alrededor de una hora para que funcionara bien.</p>

<p>Para <strong>Altair</strong>  la cosa se puso más interesante. Intenté hacer el mismo acercamiento pero no logré hacerlo porque el <code class="language-plaintext highlighter-rouge">to_datetime</code> me mandaba el día en que ejecutaba el comando (por ejemplo, 20 de enero) concatenado al tiempo del reloj. Busqué un rato documentación y ejemplos pero no encontré algo que me funcionara. Así que decidí engañarme un poco.</p>

<p>Usé el comando <code class="language-plaintext highlighter-rouge">data["mytime"]=pd.to_datetime(data["time_left_qtr"]).dt.hour</code> para sólo obtener una nueva columna con los minutos del reloj y descartar los segundos. El comando toma los minutos como horas pero como sólo haré una resta pensé que sería útil de todas formas. Este fue el <em>engaño</em>. Al final, el comando para filtrar quedó <code class="language-plaintext highlighter-rouge">(data.mytime-5 &lt; 0)</code>.</p>

<p>Respecto a las gráficas se habrán dado cuenta que otra vez eran barras y ahora no eran ni <em>stack</em> ni <em>dodge</em>. Así que ¿cuál es la diferencia en esta visualización? Pues que agregué una capa (<em>layer</em>) para la línea que trae el promedio general de castigos.</p>

<p>En <strong>ggplot</strong> el código es:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_4q_5min_reg</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">df_4q_5min_reg</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">reorder</span><span class="p">(</span><span class="n">week</span><span class="p">,</span><span class="w"> </span><span class="n">sort</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">week</span><span class="p">)))</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">count</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#B0B7BC"</span><span class="p">)</span><span class="o">+</span><span class="w"> </span><span class="c1">#gray</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">count</span><span class="p">)),</span><span class="w">
             </span><span class="n">color</span><span class="o">=</span><span class="s1">'#C8032B'</span><span class="p">,</span><span class="w">
             </span><span class="n">linetype</span><span class="o">=</span><span class="s2">"dashed"</span><span class="p">,</span><span class="w">
             </span><span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w">
             </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.8</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">annotate</span><span class="p">(</span><span class="n">geom</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="m">6.3</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="m">3.5</span><span class="p">,</span><span class="w"> 
           </span><span class="n">label</span><span class="o">=</span><span class="s2">"Promedio de Castigos"</span><span class="p">,</span><span class="w">
           </span><span class="n">family</span><span class="o">=</span><span class="s2">"mono"</span><span class="p">,</span><span class="w">
           </span><span class="n">color</span><span class="o">=</span><span class="s2">"#C8032B"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">count</span><span class="p">),</span><span class="w">
                </span><span class="n">family</span><span class="o">=</span><span class="s2">"mono"</span><span class="p">,</span><span class="w">
                </span><span class="n">vjust</span><span class="o">=</span><span class="m">2.5</span><span class="p">,</span><span class="w">
                </span><span class="n">color</span><span class="o">=</span><span class="s2">"#C8032B"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="w">
    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">element_blank</span><span class="p">()</span><span class="w">
  </span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Semana"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Número de Castigos"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Castigos de Contrarios\nEn los 5 min Finales - ggplot"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="o">=</span><span class="s2">"Partidos de Temporada Regular"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="o">=</span><span class="s2">"@nerudista"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_pats_white</span><span class="p">;</span><span class="w">  </span><span class="n">plot_4q_5min_reg</span><span class="w">
  
</span></code></pre></div></div>
<p>La secuencia de pasos de <strong>ggplot</strong> fue:</p>

<ol>
  <li>Definir los aes() de la gráfica y hacer un <code class="language-plaintext highlighter-rouge">reorder</code> para que se ordenen las semanas numéricamente. Sin esto el orden quedaba como 1,11,12,…,2,3,4,etc.</li>
  <li>Crear la gráfica de barras con <code class="language-plaintext highlighter-rouge">geom_bar()</code>,</li>
  <li>Crear la línea de promedios con <code class="language-plaintext highlighter-rouge">geom_hline</code>. El promedio se especifica con <code class="language-plaintext highlighter-rouge">yintercept = mean(count)</code>.</li>
  <li>Definir una etiqueta para la línea de promedios con <code class="language-plaintext highlighter-rouge">annotate</code>.</li>
  <li>Crear la capa para los textos de las barras con <code class="language-plaintext highlighter-rouge">geom_text()</code>.</li>
  <li>Generar el titulo y el _caption_inicio.</li>
  <li>Aplicar el <em>theme</em> que ya tenemos definido.</li>
</ol>

<p>En <strong>Altair</strong> el código fue:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#plot_4q_5min_reg
</span><span class="n">bar_5min_reg</span> <span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_4q_5min_reg</span><span class="p">).</span><span class="n">mark_bar</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s">"#B0B7BC"</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span>
  <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">"week:N"</span><span class="p">,</span> 
          <span class="n">title</span><span class="o">=</span><span class="s">"Semana"</span><span class="p">,</span>
          <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">labelAngle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1">#pone los número de semana sin voltear
</span>          <span class="p">),</span>
  <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">"count:Q"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"Número de castigos"</span><span class="p">)</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">width</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
   <span class="n">height</span><span class="o">=</span><span class="mi">300</span>
<span class="p">)</span>

<span class="n">text_5min_reg</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_4q_5min_reg</span><span class="p">).</span><span class="n">mark_text</span><span class="p">(</span>
     
    <span class="n">dy</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> 
    <span class="n">font</span><span class="o">=</span><span class="s">"Courier"</span><span class="p">,</span>
    <span class="n">fontSize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">'week:N'</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">'count:Q'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
    <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="s">'count:Q'</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">rule</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_4q_5min_reg</span><span class="p">).</span><span class="n">mark_rule</span><span class="p">(</span><span class="n">strokeDash</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">'mean(count):Q'</span><span class="p">),</span>
     <span class="n">size</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mf">1.5</span><span class="p">),</span>    
      
<span class="p">)</span>

<span class="n">base_5min_reg</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">layer</span><span class="p">(</span><span class="n">bar_5min_reg</span> <span class="p">,</span> <span class="n">text_5min_reg</span> <span class="p">,</span> <span class="n">rule</span><span class="p">).</span><span class="n">properties</span><span class="p">(</span>
<span class="n">width</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">400</span>
<span class="p">)</span>
<span class="n">base_5min_reg</span>

<span class="n">title</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span>
    <span class="p">{</span><span class="s">"values"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"text"</span><span class="p">:</span> <span class="s">"Castigos de Contarios en los 5 Minutos Finales"</span><span class="p">}]}</span>
<span class="p">).</span><span class="n">mark_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#08415C"</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s">'Courier'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s">"text:N"</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
<span class="n">width</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">5</span>
<span class="p">)</span>

<span class="n">subtitle</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span>
    <span class="p">{</span><span class="s">"values"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"text"</span><span class="p">:</span> <span class="s">"Partidos de Temporada Regular"</span><span class="p">}]}</span>
<span class="p">).</span><span class="n">mark_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#08415C"</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s">'Courier'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s">"text:N"</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
<span class="n">width</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">final_5min_reg</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">vconcat</span><span class="p">(</span><span class="c1">#title, 
</span>             <span class="n">subtitle</span><span class="p">,</span>
             <span class="n">base_5min_reg</span><span class="p">,</span>
             <span class="n">caption_chart</span><span class="p">).</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">title</span><span class="o">=</span><span class="s">"Castigos de Contrarios en los 5 min Finales - Altair"</span>  <span class="p">)</span>

<span class="n">final_5min_reg</span>
</code></pre></div></div>

<p>Si bien el código se ve más largo por el tema de la concatenación vertical de gráficas, el inicio es muy parecido:</p>

<ol>
  <li>Crear chart.</li>
  <li>Crear la gráfica de barra con <code class="language-plaintext highlighter-rouge">mark_bar()</code>.</li>
  <li>Crear otra gráfica para los textos arriba de las barras con <code class="language-plaintext highlighter-rouge">mark_text()</code>.</li>
  <li>Crear la capa con el promedio de castigos con <code class="language-plaintext highlighter-rouge">mark_rule()</code>.</li>
  <li>Hacer una <em>layer chart</em> para unir las tres capas anteriores anteriores.</li>
  <li>Crear subtítulo.</li>
  <li>Crear una gráfica para el <em>caption</em> (esta ya la traemos desde el inicio pero la pongo para que quede en los pasos.)</li>
  <li>Concatenar verticalmente la <em>layer chart</em> con el <em>caption</em> y el <em>subtitle</em></li>
  <li>Ajustar el título</li>
</ol>

<p>De nueva cuenta en  <strong>Altair</strong> no logré quitar el eje Y por completo. Pude quitar los labels y los ticks pero no la línea del eje. Como aquí no hay ningún <em>legend</em> no se ve el problema de la separación entre el título , el subtítulo y la gráfica. Si no sabes de qué hablo, más abajo tengo más ejemplos.</p>

<p>Ahora vayamos con las semanas de postemporada.</p>

<h2 id="castigos-en-los-últimos-5-min-del-último-cuarto-de-postemporada-con-stack-bar-plots">Castigos en los últimos 5 min del último cuarto, de postemporada, con <em>stack bar plots</em></h2>

<p>Misma premisa: qué tanto ayudan a los Pats, al castigar a los contrarios, en los últimos minutos del partido pero ahora en partidos de eliminación.</p>

<p>Van las gráficas:</p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigoPorSemanasPost.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigoPorSemanasPost.png?raw=true" /></p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigoPorSemanasPost.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigoPorSemanasPost.png?raw=true" /></p>

<p>Estos son los códigos para la creación de los dataframes:</p>

<p><strong>R</strong>:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">
</span><span class="c1">########## CASTIGOS POST-TEMPORADA </span><span class="w">
</span><span class="c1">#El dataset tiene un error. EL SB de 2014 lo pone como Week 5 y debe ser 4</span><span class="w">

</span><span class="n">data</span><span class="o">$</span><span class="n">week</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifelse</span><span class="p">(</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">game_type</span><span class="o">==</span><span class="s1">'POST'</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">week</span><span class="o">==</span><span class="m">5</span><span class="p">,</span><span class="w">
                     </span><span class="s1">'4'</span><span class="p">,</span><span class="w">
                     </span><span class="n">data</span><span class="o">$</span><span class="n">week</span><span class="p">)</span><span class="w">



  </span><span class="n">df_4q_5min_post</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="w"> </span><span class="n">difftime</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">mytime</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">quarter</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"Q4"</span><span class="p">,</span><span class="w">
          </span><span class="n">game_type</span><span class="o">==</span><span class="s1">'POST'</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="w"> </span><span class="o">!=</span><span class="s1">'NE'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">week_type</span><span class="p">,</span><span class="n">penalty_side</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">n</span><span class="p">())</span><span class="w">
  
  </span><span class="c1">#Cambiar los labels, de los levels, de team_penalty_cat</span><span class="w">
  </span><span class="n">df_4q_5min_post</span><span class="o">$</span><span class="n">week_type</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">df_4q_5min_post</span><span class="o">$</span><span class="n">week_type</span><span class="p">,</span><span class="w">
                                      </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Wildcard"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Ronda Divisional"</span><span class="p">,</span><span class="w">
                                                 </span><span class="s2">"Ronda Campeonato"</span><span class="p">,</span><span class="s2">"Super Tazón"</span><span class="p">)</span><span class="w">
                                      </span><span class="p">)</span><span class="w">
  
</span></code></pre></div></div>

<p>Para <strong>ggplot</strong> arreglé un error que tiene el dataset: había un partido que estaba como semana 5 cuando debía ser 4. Eso lo arreglé con el <code class="language-plaintext highlighter-rouge">ifelse</code>. Además cambié los <code class="language-plaintext highlighter-rouge">levels</code> de la columna <code class="language-plaintext highlighter-rouge">week_type</code> para cambiar de semana 1,2,3,4 a Wildcard, Ronda Divisional, etc.</p>

<p>Ahora el dataset de <strong>Python</strong>:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">########## CASTIGOS POST-TEMPORADA 
</span><span class="k">def</span> <span class="nf">corregir_semana_sb</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">.</span><span class="n">game_type</span> <span class="o">==</span> <span class="s">'POST'</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">.</span><span class="n">week</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"Wildcard"</span>
        <span class="k">elif</span> <span class="n">df</span><span class="p">.</span><span class="n">week</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"Ronda Divisional"</span>
        <span class="k">elif</span> <span class="n">df</span><span class="p">.</span><span class="n">week</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"Ronda Campeonato"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">"Super Tazón"</span>

<span class="n">data</span><span class="p">[</span><span class="s">"myweek"</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="n">corregir_semana_sb</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df_4q_5min_post</span> <span class="o">=</span><span class="n">data</span><span class="p">[(</span><span class="n">data</span><span class="p">.</span><span class="n">mytime</span><span class="o">-</span><span class="mi">5</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>  <span class="o">&amp;</span> 
     <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">quarter</span> <span class="o">==</span> <span class="s">'Q4'</span><span class="p">)</span> <span class="o">&amp;</span>
     <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">game_type</span><span class="o">==</span><span class="s">'POST'</span><span class="p">)</span> <span class="o">&amp;</span>
     <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">team_penalty_cat</span> <span class="o">!=</span> <span class="s">'NE'</span><span class="p">)].</span><span class="n">groupby</span><span class="p">([</span><span class="s">"myweek"</span><span class="p">,</span><span class="s">"penalty_side"</span><span class="p">])[</span><span class="s">"myweek"</span><span class="p">].</span><span class="n">count</span><span class="p">().</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"count_pen"</span><span class="p">)</span>

<span class="n">df_4q_5min_post</span>
</code></pre></div></div>

<p>Acá hice una función llamada <code class="language-plaintext highlighter-rouge">corregir_semana_sb</code> que después apliqué con un <code class="language-plaintext highlighter-rouge">apply</code> en Pandas. Aquí de plano cambié el valor de los datos y no solo el “level” como en <strong>R</strong>. Intenté buscar algo similar en <strong>Python</strong> pero no lo encontré. Por eso me decidí a cambiar directamente el valor aunque no me encanta.</p>

<p>Ahora va el código de <strong>ggplot</strong> para la gráfica:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_4q_5min_post</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">df_4q_5min_post</span><span class="p">,</span><span class="w">
                              </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">week_type</span><span class="p">,</span><span class="w">
                              </span><span class="n">y</span><span class="o">=</span><span class="n">count</span><span class="w"> </span><span class="p">,</span><span class="w"> 
                              </span><span class="n">fill</span><span class="o">=</span><span class="n">penalty_side</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
          </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">count</span><span class="p">),</span><span class="w">
             </span><span class="n">family</span><span class="o">=</span><span class="s2">"mono"</span><span class="p">,</span><span class="w">
             </span><span class="n">position</span><span class="o">=</span><span class="n">position_stack</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.5</span><span class="p">),</span><span class="w">
             </span><span class="n">vjust</span><span class="o">=</span><span class="m">0.5</span><span class="p">,</span><span class="w">
             </span><span class="n">color</span><span class="o">=</span><span class="s2">"#FFFFFF"</span><span class="w">
  </span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Semana"</span><span class="p">)</span><span class="o">+</span><span class="w">
</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Castigos de Contrarios\nEn los 5 min Finales - ggplot"</span><span class="p">,</span><span class="w">
     </span><span class="n">subtitle</span><span class="o">=</span><span class="s2">"Partidos de Postemporada"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="o">=</span><span class="s2">"@nerudista"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
       </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">guide_legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">NULL</span><span class="p">))</span><span class="o">+</span><span class="w">      </span><span class="c1">#remove legend title</span><span class="w">
       </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#08415C"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#B0B7BC"</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="w">
      </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
      </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()</span><span class="w">
    </span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme_pats_white</span><span class="p">;</span><span class="w">  </span><span class="n">plot_4q_5min_post</span><span class="w">
</span></code></pre></div></div>

<p>La secuencia de pasos fue:</p>

<ol>
  <li>Definir los <code class="language-plaintext highlighter-rouge">aes()</code> de la gráfica incluyendo el <code class="language-plaintext highlighter-rouge">fill</code> para establecer el color de la barra apilada.</li>
  <li>Crear la gráfica de barra.</li>
  <li>Sobre la anterior crear la gráfica para los textos arriba de las barras.</li>
  <li>Crear el título, subtítulo y el caption.</li>
  <li>Aplicar el tema de los Pats que estamos usando.</li>
</ol>

<p>Para <strong>Altair</strong> el código es:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bar_5min_post</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_4q_5min_post</span><span class="p">).</span><span class="n">mark_bar</span><span class="p">().</span><span class="n">encode</span><span class="p">(</span>
   <span class="n">x</span> <span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">"myweek:N"</span><span class="p">,</span>
             <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="s">'Wildcard'</span><span class="p">,</span> <span class="s">'Ronda Divisional'</span><span class="p">,</span> <span class="s">'Ronda Campeonato'</span><span class="p">,</span><span class="s">'Super Tazón'</span><span class="p">],</span>
             <span class="n">title</span><span class="o">=</span><span class="s">"Semana"</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labelAngle</span><span class="o">=</span><span class="mi">0</span> <span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span> 
           <span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">"count_pen:Q"</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s">'zero'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>    
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="s">'penalty_side'</span><span class="p">,</span>                  
                   <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s">"horizontal"</span><span class="p">,</span>
                                      <span class="n">orient</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span>
                                      <span class="n">legendX</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
                                      <span class="n">legendY</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                      <span class="n">columnPadding</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                      <span class="n">padding</span><span class="o">=-</span><span class="mi">25</span><span class="p">,)</span> 
                   <span class="p">)</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
<span class="n">width</span><span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
<span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>

<span class="n">text_5min_post</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_4q_5min_post</span><span class="p">).</span><span class="n">mark_text</span><span class="p">(</span>
    <span class="n">font</span><span class="o">=</span><span class="s">"Courier"</span><span class="p">,</span>
    <span class="n">fontSize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="n">dy</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> 
    <span class="n">color</span><span class="o">=</span><span class="s">'white'</span>
<span class="p">).</span><span class="n">encode</span><span class="p">(</span>
     <span class="n">x</span> <span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">"myweek:N"</span><span class="p">,</span>
              <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="s">'Wildcard'</span><span class="p">,</span> <span class="s">'Ronda Divisional'</span><span class="p">,</span> <span class="s">'Ronda Campeonato'</span><span class="p">,</span><span class="s">'Super Tazón'</span><span class="p">],</span>
              <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
     <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">"count_pen:Q"</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s">'zero'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>    
     <span class="n">detail</span><span class="o">=</span><span class="s">'penalty_side:N'</span><span class="p">,</span>
     <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="s">'count_pen:Q'</span> <span class="p">)</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
<span class="n">width</span><span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
<span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>


<span class="n">base_5min_post</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">layer</span><span class="p">(</span> <span class="n">bar_5min_post</span><span class="p">,</span><span class="n">text_5min_post</span> <span class="p">)</span>
<span class="n">base_5min_post</span>

<span class="n">subtitle</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span>
    <span class="p">{</span><span class="s">"values"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"text"</span><span class="p">:</span> <span class="s">"Partidos de Postemporada"</span><span class="p">}]}</span>
<span class="p">).</span><span class="n">mark_text</span><span class="p">(</span><span class="n">dx</span><span class="o">=-</span><span class="mi">165</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#08415C"</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s">'Courier'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s">"text:N"</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">width</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="n">subtitle</span>

<span class="n">final_5min_post</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">vconcat</span><span class="p">(</span> 
             <span class="n">subtitle</span><span class="p">,</span>
             <span class="n">base_5min_post</span><span class="p">,</span>
             <span class="n">caption_chart</span><span class="p">).</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">title</span><span class="o">=</span><span class="s">"Castigos de Contrarios en los 5 min Finales - Altair"</span>  <span class="p">)</span>

</code></pre></div></div>

<p>La lógica de esta gráfica es fue:</p>

<ol>
  <li>Crear un chart con un <code class="language-plaintext highlighter-rouge">mark_bar()</code>. El <code class="language-plaintext highlighter-rouge">color</code> es el que nos va ayudar con la barra apilada.</li>
  <li>Crear un chart con un <code class="language-plaintext highlighter-rouge">mark_text()</code>. En este paso y el anterior puse explícitamente el sort del tipo de semana.</li>
  <li>Hacer una <em>layer chart</em> para unir las dos anteriores.</li>
  <li>Crear una gráfica para el <em>caption</em>.</li>
  <li>Crear una gráfica para el <em>subtitle</em>.</li>
  <li>Concatenar verticalmente la <em>layer chart</em> con el <em>caption</em> y el <em>subtitle</em>.</li>
  <li>Poner el título de la gráfica.</li>
</ol>

<p>Aquí podemos ver el error que mencionaba en la gráfica anterior. El <em>legend</em> queda justo debajo del título y no debajo del subtítulo. Si son observadores, podrán darse cuenta que la línea del eje X tampoco desapareció por completo.</p>

<p>Esta gráfica es muy similar a una del post pasado sólo que aquí le metí lo del <code class="language-plaintext highlighter-rouge">sort</code>. Seguro les puede servir más adelante.</p>

<h2 id="castigos-en-juegos-de-una-posesión-o-cómo-diablos-uso-el-facet-para-duplicar-gráficas">Castigos en juegos de una posesión o cómo diablos uso el <em>facet</em> para duplicar gráficas</h2>

<p>Aquí intenté ver qué tanto ayudan a los Pats en juegos que se decidieron por menos de 8 puntos. Es decir, una posesión de balón.</p>

<p>Va el resultado de los dos lenguajes:</p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotJuegosUnaPosesion.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotJuegosUnaPosesion.png?raw=true" /></p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairJuegosUnaPosesionBar.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairJuegosUnaPosesionBar.png?raw=true" /></p>

<p>Los dataframes para esta viz fueron:</p>

<p><strong>R</strong></p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_juegos_posesion</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">game_winner_cat</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="p">,</span><span class="n">season</span><span class="p">,</span><span class="n">week</span><span class="p">,</span><span class="n">quarter</span><span class="p">,</span><span class="n">one_posession_game</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="p">(</span><span class="n">one_posession_game</span><span class="o">==</span><span class="s1">'Juego de una posesión'</span><span class="p">,</span><span class="w"> </span><span class="n">quarter</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'Q5'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarise</span><span class="p">(</span><span class="n">cnt_pen</span><span class="o">=</span><span class="n">n</span><span class="p">())</span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">game_winner_cat</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="p">,</span><span class="n">quarter</span><span class="p">,</span><span class="n">one_posession_game</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_pen</span><span class="o">=</span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">cnt_pen</span><span class="p">),</span><span class="m">2</span><span class="p">))</span><span class="w">
  
  </span><span class="c1">#Cambiar los labels, de los levels, de team_penalty_cat</span><span class="w">
  </span><span class="n">df_juegos_posesion</span><span class="o">$</span><span class="n">team_penalty_cat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">df_juegos_posesion</span><span class="o">$</span><span class="n">team_penalty_cat</span><span class="p">,</span><span class="w">
                                                </span><span class="n">levels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"NE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Oponente"</span><span class="p">),</span><span class="w"> 
                                                </span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Castigo\nde NE"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Castigo\nde Oponente"</span><span class="p">))</span><span class="w">

</span></code></pre></div></div>
<p>En este dataframe anidé dos <code class="language-plaintext highlighter-rouge">group_by</code> con su respectivo <code class="language-plaintext highlighter-rouge">summarise</code> y además tiene un <code class="language-plaintext highlighter-rouge">filter</code>. De nueva cuenta cambié los levels de un campo para que las etiquetas de la gráfica tuvieran la cadena que yo quería.</p>

<p>En <strong>Python</strong> el código fue:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pre_df_juegos_posesion</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"game_winner_cat"</span><span class="p">,</span><span class="s">"team_penalty_cat"</span><span class="p">,</span><span class="s">"season"</span><span class="p">,</span><span class="s">"week"</span><span class="p">,</span><span class="s">"quarter"</span><span class="p">,</span>\
<span class="s">"one_posession_game"</span><span class="p">])[</span><span class="s">"game_winner_cat"</span><span class="p">].</span><span class="n">count</span><span class="p">().</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"cnt_pen"</span><span class="p">)</span>
<span class="n">pre_df_juegos_posesion</span><span class="p">[:</span><span class="mi">6</span><span class="p">]</span>

<span class="n">df_juegos_posesion</span><span class="o">=</span> <span class="n">pre_df_juegos_posesion</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"game_winner_cat"</span><span class="p">,</span><span class="s">"team_penalty_cat"</span><span class="p">,</span><span class="s">"quarter"</span><span class="p">,</span>\
<span class="s">"one_posession_game"</span><span class="p">])[</span><span class="s">"cnt_pen"</span><span class="p">].</span><span class="n">mean</span><span class="p">().</span><span class="nb">round</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"mean_pen"</span><span class="p">)</span>
<span class="n">df_juegos_posesion</span><span class="p">.</span><span class="n">game_winner_cat</span><span class="o">=</span>\
 <span class="n">df_juegos_posesion</span><span class="p">.</span><span class="n">game_winner_cat</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s">'Cuando Pats ganan'</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s">"NE"</span> <span class="k">else</span> <span class="s">'Cuando Pats Pierden'</span> <span class="p">)</span>
<span class="n">df_juegos_posesion</span><span class="p">.</span><span class="n">team_penalty_cat</span><span class="o">=</span>\
  <span class="n">df_juegos_posesion</span><span class="p">.</span><span class="n">team_penalty_cat</span><span class="p">.</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s">'Castigo de NE'</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s">"NE"</span> <span class="k">else</span> <span class="s">'Castigo de Oponente'</span> <span class="p">)</span>
<span class="n">df_juegos_posesion</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>En este caso hice el dataframe en dos pasos pero aquí no use un <code class="language-plaintext highlighter-rouge">filter</code>. Ese lo pondré con <strong>Altair</strong> para que puedan examinar después el JSON que genera. Al igual que en gráficas pasadas, cambié directamente el valor de los datos pero esta vez con <em>funciones lambda</em>. Para ser honesto, me parecen una chulada de maíz prieto.</p>

<p>Pasemos al código de <strong>ggplot</strong>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_juegos_1_posesion</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">df_juegos_posesion</span><span class="p">,</span><span class="w">
         </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">game_winner_cat</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">mean_pen</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">quarter</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">geom_bar</span><span class="p">(</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
              </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">geom_text</span><span class="p">(</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">mean_pen</span><span class="p">),</span><span class="w">
               </span><span class="n">family</span><span class="o">=</span><span class="s2">"mono"</span><span class="p">,</span><span class="w">
               </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">.9</span><span class="p">),</span><span class="w">
               </span><span class="n">vjust</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w">
               </span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">,</span><span class="w">
               </span><span class="n">color</span><span class="o">=</span><span class="s2">"#FFFFFF"</span><span class="w">
    </span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">facet_grid</span><span class="p">(</span><span class="w"> </span><span class="n">team_penalty_cat</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.</span><span class="w">   </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Cuando Pats ganan"</span><span class="p">,</span><span class="s2">"Cuando Pats pierden"</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#a8bdc6"</span><span class="p">,</span><span class="s2">"#8ea8b4"</span><span class="p">,</span><span class="s2">"#4b7488"</span><span class="p">,</span><span class="s2">"#08415C"</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Promedio de Castigos por Quarter - ggplot"</span><span class="p">,</span><span class="w">
         </span><span class="n">subtitle</span><span class="o">=</span><span class="s2">"Juegos de Una Posesión"</span><span class="p">,</span><span class="w">
         </span><span class="n">caption</span><span class="o">=</span><span class="s2">"@nerudista"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">guide_legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">NULL</span><span class="p">))</span><span class="o">+</span><span class="w">      </span><span class="c1">#remove legend title</span><span class="w">
    </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="o">+</span><span class="w">            </span><span class="c1">#remove y axis numbers</span><span class="w">
    </span><span class="n">theme_pats_white</span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="w">
      </span><span class="c1">#titulos del facet</span><span class="w">
      </span><span class="n">strip.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">90</span><span class="p">),</span><span class="w">
      </span><span class="c1">#remover titulos de los ejes</span><span class="w">
      </span><span class="n">axis.title.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">  
      </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()</span><span class="w">
      </span><span class="p">);</span><span class="w"> </span><span class="n">plot_juegos_1_posesion</span><span class="p">;</span><span class="w">
  
  
</span></code></pre></div></div>
<p>Si se fijan atentamente, la gráfica original es una barra <em>dodge</em> que se va a replicar. Esta replicación la vamos a hacer con <code class="language-plaintext highlighter-rouge">facet_grid( team_penalty_cat ~ .   ) </code>. <code class="language-plaintext highlighter-rouge">team_penalty_cat</code> es el campo que hace la diferencia entre <em>dodge bars</em>.</p>

<p>Va la secuencia de pasos:</p>

<ol>
  <li>Definir los aes() de la gráfica. Recuerden el <code class="language-plaintext highlighter-rouge">fill</code> para la escala de color que usaremos después.</li>
  <li>Crear la gráfica de barras con <code class="language-plaintext highlighter-rouge">geom_bar()</code> y usando el <code class="language-plaintext highlighter-rouge">position = "dodge"</code>.</li>
  <li>Crear la capa de texto con <code class="language-plaintext highlighter-rouge">geom_text</code>. Para que los textos se acomoden tuve que usar <code class="language-plaintext highlighter-rouge">position=position_dodge()</code>.</li>
  <li>Replicar las gráficas con <code class="language-plaintext highlighter-rouge">facet_grid( team_penalty_cat ~ .   )</code></li>
  <li>Cambiar los los labels del eje X.</li>
  <li>Definir la paleta de colores que usaré para las barras con <code class="language-plaintext highlighter-rouge">scale_fill_manual()</code>.</li>
  <li>Crear el título, subtítulo y el caption.</li>
  <li>Aplicar el <em>theme</em> que ya tenemos definido.</li>
</ol>

<p>Para <strong>Altair</strong> la cosa se puso color de hormiga. Si revisan bien la gráfica pueden darse cuenta que no tiene un <em>layer</em> para el texto. Vamos por pasos. Primero hice la capa de las barras:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">domain</span> <span class="o">=</span> <span class="p">[</span><span class="s">'Q1'</span><span class="p">,</span> <span class="s">'Q2'</span><span class="p">,</span> <span class="s">'Q3'</span><span class="p">,</span><span class="s">'Q4'</span><span class="p">]</span>
<span class="n">range_</span> <span class="o">=</span> <span class="p">[</span><span class="s">"#a8bdc6"</span><span class="p">,</span><span class="s">"#8ea8b4"</span><span class="p">,</span><span class="s">"#4b7488"</span><span class="p">,</span><span class="s">"#08415C"</span><span class="p">]</span>

<span class="n">bar_juegos_1_posesion</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_juegos_posesion</span><span class="p">[(</span><span class="n">df_juegos_posesion</span><span class="p">.</span><span class="n">one_posession_game</span><span class="o">==</span><span class="s">'Juego de una posesión'</span> <span class="p">)</span> <span class="o">&amp;</span> \
                              <span class="p">(</span><span class="n">df_juegos_posesion</span><span class="p">.</span><span class="n">quarter</span> <span class="o">!=</span><span class="s">'Q5'</span> <span class="p">)]).</span><span class="n">mark_bar</span><span class="p">(</span>
    
<span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="n">alt</span><span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="s">"column"</span><span class="p">),</span>
              <span class="nb">type</span><span class="o">=</span><span class="s">'ordinal'</span><span class="p">,</span>              
              <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="n">alt</span><span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="s">"row"</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="s">'quantitative'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
    <span class="n">column</span><span class="o">=</span><span class="s">"game_winner_cat"</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="s">"team_penalty_cat"</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="s">'quarter'</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">range_</span><span class="p">),</span>
                    <span class="n">legend</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">300</span>
<span class="p">).</span><span class="n">repeat</span><span class="p">(</span>
     <span class="n">row</span><span class="o">=</span><span class="p">[</span><span class="s">'mean_pen'</span><span class="p">],</span>
     <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s">'quarter'</span><span class="p">],</span>
     <span class="n">title</span><span class="o">=</span><span class="s">"Promedio de Castigos por Quarter - Altair"</span>
<span class="p">).</span><span class="n">configure_header</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">labelFont</span><span class="o">=</span><span class="s">"Courier"</span><span class="p">,</span>
    <span class="n">labelFontSize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span>
    <span class="n">labelAlign</span><span class="o">=</span><span class="s">"center"</span><span class="p">,</span>
    <span class="n">labelColor</span><span class="o">=</span><span class="s">"#08415C"</span><span class="p">,</span>

<span class="p">)</span>

<span class="n">bar_juegos_1_posesion</span>
</code></pre></div></div>

<p>Van los pasos para esta capa:</p>

<ol>
  <li>Crear dos listas: una para el rango y otra para el dominio de los datos. En el dominio puse los distintos valores del campo <code class="language-plaintext highlighter-rouge">quarter</code> y en el rango puse la paleta de colores que voy a usar para cada valor.</li>
  <li>Crear chart poniendo el filtro dentro del <code class="language-plaintext highlighter-rouge">chart()</code>.</li>
  <li>Crear la gráfica de barra con <code class="language-plaintext highlighter-rouge">mark_bar()</code>.</li>
  <li>En el <code class="language-plaintext highlighter-rouge">encode</code> definí el <code class="language-plaintext highlighter-rouge">alt.repeat("column"),</code> en el eje X y <code class="language-plaintext highlighter-rouge">alt.repeat("row")</code> en el eje Y. Si se fijan, ahí no puse qué campo voy a usar solo que voy a repetir.</li>
  <li>Usar la paleta de color dentro de <code class="language-plaintext highlighter-rouge">alt.Scale()</code> que está dentro de <code class="language-plaintext highlighter-rouge">alt.Color()</code></li>
  <li>Cambiar el ancho de cada gráfica para que quepa en pantalla. Eso es con <code class="language-plaintext highlighter-rouge">width = 300</code> dentro de <code class="language-plaintext highlighter-rouge">properties</code>.</li>
  <li>Usar <code class="language-plaintext highlighter-rouge">repeat</code> para especificar qué campos se van a usar para los row y el column que pusimos en el <code class="language-plaintext highlighter-rouge">encode</code> del paso 4.</li>
</ol>

<p>Después generé la capa de los textos:</p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairJuegosUnaPosesionText.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairJuegosUnaPosesionText.png?raw=true" /></p>

<p>Con este código:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text_juegos_1_posesion</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_juegos_posesion</span><span class="p">[(</span><span class="n">df_juegos_posesion</span><span class="p">.</span><span class="n">one_posession_game</span><span class="o">==</span><span class="s">'Juego de una posesión'</span> <span class="p">)</span> <span class="o">&amp;</span> \
                              <span class="p">(</span><span class="n">df_juegos_posesion</span><span class="p">.</span><span class="n">quarter</span> <span class="o">!=</span><span class="s">'Q5'</span> <span class="p">)]).</span><span class="n">mark_text</span><span class="p">(</span>
    <span class="n">font</span><span class="o">=</span><span class="s">"Courier"</span><span class="p">,</span>
    <span class="n">fontSize</span> <span class="o">=</span><span class="mi">12</span><span class="p">,</span>

<span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="n">alt</span><span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="s">"column"</span><span class="p">),</span>
              <span class="nb">type</span><span class="o">=</span><span class="s">'ordinal'</span><span class="p">,</span>
              <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="n">alt</span><span class="p">.</span><span class="n">repeat</span><span class="p">(</span><span class="s">"row"</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="s">'quantitative'</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
    <span class="n">column</span><span class="o">=</span><span class="s">"game_winner_cat"</span><span class="p">,</span>
    <span class="n">row</span><span class="o">=</span><span class="s">"team_penalty_cat"</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="s">"mean_pen:Q"</span><span class="p">)</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">300</span>
<span class="p">).</span><span class="n">repeat</span><span class="p">(</span>
     <span class="n">row</span><span class="o">=</span><span class="p">[</span><span class="s">'mean_pen'</span><span class="p">],</span>
     <span class="n">column</span><span class="o">=</span><span class="p">[</span><span class="s">'quarter'</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">text_juegos_1_posesion</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'./graficas/Altair/AltairJuegosUnaPosesionText.png'</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">text_juegos_1_posesion</span>
</code></pre></div></div>
<p>Sin embargo, cuando quise unir las capas con <code class="language-plaintext highlighter-rouge">bar_juegos_1_posesion + text_juegos_1_posesion</code> apareció este error:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ValueError</span><span class="p">:</span> <span class="n">Objects</span> <span class="k">with</span> <span class="s">"config"</span> <span class="n">attribute</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">used</span> <span class="n">within</span> <span class="n">LayerChart</span><span class="p">.</span> <span class="n">Consider</span> <span class="n">defining</span> <span class="n">the</span> <span class="n">config</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">LayerChart</span> <span class="nb">object</span> <span class="n">instead</span>
</code></pre></div></div>

<p>Intenté de varias formas unirlas pero no lo logré. Es la espina que más se me queda clavada de todo el ejercicio. Si alguien me puede pasar tips para terminarla, se los agradeceré muchísimo.</p>

<h2 id="correlación-entre-puntos-recibidos-y-yardas-con-scatterplots">Correlación entre puntos recibidos y yardas con <em>scatterplots</em></h2>

<p>Hora de cambiar de tipo de gráfica. Quise ver si había algún tipo de correlación entre los puntos que les anotan a los Pats y los castigos que les son marcados a sus oponentes.</p>

<p>Va el resultado de ambas #BibliotecasNoLibrerias</p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigosVSYardas.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigosVSYardas.png?raw=true" /></p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigosVSYardas.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigosVSYardas.png?raw=true" /></p>

<p>Y ahora toca ver los dataframes:</p>

<p><strong>R:</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_temporada_help</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="n">week</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="p">,</span><span class="n">penalty_side</span><span class="p">,</span><span class="n">game_type</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarise</span><span class="p">(</span><span class="n">cnt_pen_game</span><span class="o">=</span><span class="n">n</span><span class="p">(),</span><span class="w">
              </span><span class="n">pats_points_game</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">pats_points</span><span class="p">),</span><span class="w">
              </span><span class="n">opp_points_game</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">opps_points</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">filter</span><span class="w"> </span><span class="p">(</span><span class="w">  </span><span class="n">team_penalty_cat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">'Oponente'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="n">penalty_side</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarise</span><span class="p">(</span><span class="n">sum_pen_season</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">cnt_pen_game</span><span class="p">),</span><span class="w">
              </span><span class="n">opp_points_season</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">opp_points_game</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<p>De nueva cuenta anidé dos <code class="language-plaintext highlighter-rouge">group_by</code> - <code class="language-plaintext highlighter-rouge">summarise</code> y un <code class="language-plaintext highlighter-rouge">filter</code> para tener los datos ya limpios y pasarlos a <strong>ggplot</strong>.</p>

<p><strong>Python</strong></p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_temporada_help</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"season"</span><span class="p">,</span><span class="s">"week"</span><span class="p">,</span><span class="s">"team_penalty_cat"</span><span class="p">,</span><span class="s">"penalty_side"</span><span class="p">,</span><span class="s">"game_type"</span><span class="p">]).</span><span class="n">agg</span><span class="p">(</span>\
                                                                              <span class="n">pats_points_game</span> <span class="o">=</span> <span class="p">(</span><span class="s">'pats_points'</span><span class="p">,</span><span class="s">'mean'</span><span class="p">),</span>
                                                                              <span class="n">opp_points_game</span> <span class="o">=</span> <span class="p">(</span><span class="s">'opps_points'</span><span class="p">,</span><span class="s">'mean'</span><span class="p">),</span>
                                                                              <span class="n">cnt_pen_game</span> <span class="o">=</span> <span class="p">(</span><span class="s">'opps_points'</span><span class="p">,</span><span class="s">'count'</span><span class="p">),</span>
                                     <span class="p">).</span><span class="n">reset_index</span><span class="p">().</span><span class="n">groupby</span><span class="p">([</span><span class="s">"season"</span><span class="p">,</span><span class="s">"penalty_side"</span><span class="p">,</span><span class="s">"team_penalty_cat"</span><span class="p">]).</span><span class="n">agg</span><span class="p">(</span>\
                                                                                                          <span class="n">sum_pen_season</span> <span class="o">=</span> <span class="p">(</span><span class="s">'cnt_pen_game'</span><span class="p">,</span><span class="s">'sum'</span><span class="p">),</span>
                                                                                                          <span class="n">opp_points_season</span><span class="o">=</span> <span class="p">(</span><span class="s">'opp_points_game'</span><span class="p">,</span><span class="s">'sum'</span><span class="p">)</span>
                                                                                                  <span class="p">).</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">df_temporada_help</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<p>Esta vez en <strong>Python</strong> repliqué el concatenamiento  de <code class="language-plaintext highlighter-rouge">groupby</code> pero ahora usé la función <code class="language-plaintext highlighter-rouge">agg()</code> para traer diferentes métricas de cada agrupación. La diferencia con <strong>R</strong> es que aquí no filtré <code class="language-plaintext highlighter-rouge">team_penalty_cat == 'Oponente'</code>. Eso lo haré ya en <strong>Altair</strong> con un <code class="language-plaintext highlighter-rouge">transform_filter()</code>.</p>

<p>Este fue el código de la gráfica en <strong>R:</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#biblioteca para textos en scatter</span><span class="w">
  </span><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">

</span><span class="n">plot_temporada_help</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="w"> </span><span class="n">df_temporada_help</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">sum_pen_season</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">opp_points_season</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">penalty_side</span><span class="p">,</span><span class="w">
                   </span><span class="c1">#shape=penalty_side,</span><span class="w">
                   </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum_pen_season</span><span class="p">,</span><span class="w">
                   </span><span class="p">),</span><span class="w">
               </span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">           </span><span class="c1">#esto elimina el legend de los bubbles</span><span class="w">
               </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">penalty_side</span><span class="p">,</span><span class="w">       </span><span class="c1">#crea linea de regresion</span><span class="w">
                    </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">penalty_side</span><span class="w">
                    </span><span class="p">),</span><span class="w"> 
                </span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
                </span><span class="n">alpha</span><span class="o">=</span><span class="m">0.2</span><span class="p">,</span><span class="w">
                </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lm</span><span class="p">,</span><span class="w">
                </span><span class="n">fullrange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">geom_text_repel</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">season</span><span class="p">,</span><span class="w">  </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">penalty_side</span><span class="p">),</span><span class="w"> 
                     </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2.5</span><span class="p">,</span><span class="w">
                     </span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
                     </span><span class="p">)</span><span class="o">+</span><span class="w">   </span><span class="c1">#label de dots</span><span class="w">
    </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#C8032B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#08415C"</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Castigos"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Puntos"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="s2">"@nerudista"</span><span class="p">,</span><span class="w">
         </span><span class="n">title</span><span class="o">=</span><span class="s2">"Castigos de Contrarios vs Puntos Permitidos - ggplot"</span><span class="p">,</span><span class="w">
         </span><span class="n">subtitle</span><span class="o">=</span><span class="s2">"Totales por Temporada"</span><span class="w">
         </span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="w">
    </span><span class="c1">#axis.line = element_line(),</span><span class="w">
    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
    </span><span class="n">legend.key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s2">"#FFFFFF"</span><span class="p">),</span><span class="w">     </span><span class="c1">#quita el color gris de la línea de castigos  </span><span class="w">
    </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="m">0.35</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_pats_white</span><span class="p">;</span><span class="w"> </span><span class="n">plot_temporada_help</span><span class="p">;</span><span class="w">
  
</span></code></pre></div></div>
<p>La secuencia fue:</p>

<ol>
  <li>Importar la biblioteca <code class="language-plaintext highlighter-rouge">ggrepel</code> para evitar que los textos dentro del <em>scatter</em> se traslapen.</li>
  <li>Definir los <code class="language-plaintext highlighter-rouge">aes()</code> de la gráfica.</li>
  <li>Crear la capa de puntos con <code class="language-plaintext highlighter-rouge">geom_point()</code>. Usé los parámetros <code class="language-plaintext highlighter-rouge">color</code>  y<code class="language-plaintext highlighter-rouge">size</code>para asignar colores al tipo de castigo y tamaño al número de castigos marcados.</li>
  <li>Generar la línea de regresión para ambos tipos de castigos con <code class="language-plaintext highlighter-rouge">geom_smooth()</code>. Para no complicar el asunto. Usé una regresión líneal con <code class="language-plaintext highlighter-rouge">method = lm</code>.</li>
  <li>Contruir la capa de textos con <code class="language-plaintext highlighter-rouge">geom_text_repel()</code>.</li>
  <li>Poner el título, subtítulo y caption.</li>
  <li>Aplicar el <em>theme</em> de los Pats.</li>
</ol>

<p>Ahora vámonos con <strong>Altair</strong>:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">range_</span><span class="o">=</span><span class="p">[</span><span class="s">"#C8032B"</span><span class="p">,</span><span class="s">"#08415C"</span><span class="p">]</span>
<span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s">"Castigo Defensivo"</span><span class="p">,</span><span class="s">"Castigo Ofensivo"</span><span class="p">]</span>
<span class="n">scatter_temporada_help_2</span> <span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_temporada_help</span><span class="p">).</span><span class="n">transform_filter</span><span class="p">(</span>    
    <span class="s">"datum.team_penalty_cat == 'Oponente'"</span>
<span class="p">).</span><span class="n">mark_circle</span><span class="p">().</span><span class="n">encode</span><span class="p">(</span>
 <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">"sum_pen_season:Q"</span><span class="p">,</span>
         <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                         <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">70</span><span class="p">,</span><span class="mi">80</span><span class="p">],)</span> <span class="p">,</span>
         <span class="n">axis</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">),</span>
 <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">"opp_points_season:Q"</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">"Puntos"</span><span class="p">,</span>         
         <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                         <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="mi">160</span><span class="p">,</span><span class="mi">400</span><span class="p">),</span>  <span class="c1">#para que no empiece desde cero el eye Y
</span>                         <span class="n">bins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">250</span><span class="p">,</span><span class="mi">300</span><span class="p">,</span><span class="mi">350</span><span class="p">,</span><span class="mi">400</span><span class="p">]),</span>
         
         <span class="n">axis</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>         
         <span class="p">),</span>
 <span class="n">color</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="s">"penalty_side"</span><span class="p">,</span>
                  <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">range_</span><span class="p">),</span>
                  <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s">"horizontal"</span><span class="p">,</span>
                                      <span class="n">orient</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span>
                                      <span class="n">legendX</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
                                      <span class="n">legendY</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                      <span class="n">columnPadding</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                      <span class="n">padding</span><span class="o">=-</span><span class="mi">25</span><span class="p">,</span>
                                   <span class="p">)</span>
                  <span class="p">),</span>
 <span class="n">size</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Size</span><span class="p">(</span><span class="s">'sum_pen_season'</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="nb">bin</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span> <span class="mi">400</span>
<span class="p">)</span>


<span class="n">scatter_reg_temorada_help</span> <span class="o">=</span> <span class="n">scatter_temporada_help_2</span> <span class="o">+</span> <span class="n">scatter_temporada_help_2</span><span class="p">.</span><span class="n">transform_regression</span><span class="p">(</span>
    <span class="n">on</span><span class="o">=</span><span class="s">'sum_pen_season'</span><span class="p">,</span><span class="n">regression</span> <span class="o">=</span><span class="s">'opp_points_season'</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"linear"</span> <span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s">'penalty_side'</span><span class="p">]</span>
<span class="p">).</span><span class="n">mark_line</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">4</span><span class="p">)</span>

<span class="n">text_temporada_help</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_temporada_help</span><span class="p">[</span><span class="n">df_temporada_help</span><span class="p">.</span><span class="n">team_penalty_cat</span> <span class="o">==</span> <span class="s">'Oponente'</span><span class="p">]).</span><span class="n">mark_text</span><span class="p">(</span>
    <span class="n">align</span><span class="o">=</span><span class="s">'left'</span><span class="p">,</span>
    <span class="n">baseline</span><span class="o">=</span><span class="s">'middle'</span><span class="p">,</span>
    <span class="n">dx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="c1">#color="red",    
</span>    <span class="n">font</span><span class="o">=</span><span class="s">"Courier"</span>
<span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">"sum_pen_season:Q"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"Castigos"</span><span class="p">),</span>
 <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">"opp_points_season:Q"</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">"Puntos"</span><span class="p">),</span>
    <span class="n">text</span><span class="o">=</span><span class="s">'season'</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="s">"penalty_side:N"</span><span class="p">,</span>
                  <span class="c1">#scale=alt.Scale(domain=domain, range=range_),                  
</span>                  <span class="p">),</span>
<span class="p">)</span>


<span class="n">base_temporada_help</span> <span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">layer</span><span class="p">(</span><span class="n">scatter_reg_temorada_help</span> <span class="p">,</span> <span class="n">text_temporada_help</span><span class="p">)</span>

<span class="n">subtitle</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span>
    <span class="p">{</span><span class="s">"values"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"text"</span><span class="p">:</span> <span class="s">"Totales por Temporada"</span><span class="p">}]}</span>
<span class="p">).</span><span class="n">mark_text</span><span class="p">(</span><span class="n">dx</span><span class="o">=-</span><span class="mi">165</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#08415C"</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s">'Courier'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s">"text:N"</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">width</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>

<span class="n">final_temporada_help</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">vconcat</span><span class="p">(</span> 
             <span class="c1">#subtitle,
</span>             <span class="n">base_temporada_help</span><span class="p">,</span>
             <span class="n">caption_chart</span><span class="p">).</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">title</span><span class="o">=</span><span class="s">"Castigos de Contrarios en los 5 min Finales - Altair"</span>  <span class="p">)</span>

</code></pre></div></div>
<p>Estos son los pasos a seguir:</p>

<ol>
  <li>Crear dos listas: una para el rango y otra para el dominio de los datos. En el dominio puse los distintos valores del campo <code class="language-plaintext highlighter-rouge">penalty_side</code> y en el rango puse la paleta de colores que voy a usar para cada valor.</li>
  <li>Usar un <code class="language-plaintext highlighter-rouge">transform_filter()</code> para agarrar sólo los castigos hechos por oponentes <code class="language-plaintext highlighter-rouge">"datum.team_penalty_cat == 'Oponente'"</code>. Si se fijan, el JSON que se va a generar para la gráfica <strong>sí</strong> va a traer todos los datos aunque no los usemos. Es por esto que en los anteriores ejemplos filtré desde antes pero para este ejercicio lo hice diferente para que puedan comparar el JSON que se genera.</li>
  <li>Crear la gráfica de puntos con <code class="language-plaintext highlighter-rouge">mark_circle()</code>. Aquí puse especial enfasis en poner las escalas del eje X y Y con los mismos saltos que en <strong>ggplot</strong>, por ejemplo <code class="language-plaintext highlighter-rouge">bins = [100,150,200,250,300,350,400]</code> en el eje Y</li>
  <li>Usar la gráfica de puntos para agregarle un <code class="language-plaintext highlighter-rouge">transform_regression</code> que cree las líneas de regresión líneal por <code class="language-plaintext highlighter-rouge">penalty_side</code>.</li>
  <li>Generar no una capa sino otro <code class="language-plaintext highlighter-rouge">chart</code> para los textos. Aquí sí filtre desde el dataframe que le estoy pasando a <strong>Altair</strong>.</li>
  <li>Hacer una <em>layer chart</em> para unir los dos <code class="language-plaintext highlighter-rouge">chart</code> anteriores.</li>
  <li>Crear subtítulo.</li>
  <li>Crear una gráfica para el <em>caption</em> (esta ya la traemos desde el inicio pero la pongo para que quede en los pasos.)</li>
  <li>Concatenar verticalmente la <em>layer chart</em> con el <em>caption</em> y el <em>subtitle</em>.</li>
  <li>Ajustar el título.</li>
</ol>

<p>Para <strong>Altair</strong> me quedan los problemas ya muy comentados: no pude quitar las líneas de los ejes y la leyenda queda entre el título y el subtítulo.</p>

<p>Este ejercicio sí me tomó bastantes horas sobre todo para entender los diferentes <code class="language-plaintext highlighter-rouge">transform_*()</code> que se pueden usar.</p>

<h2 id="la-última-y-nos-vamos-castigos-por-temporada-con-line-plots">La última y nos vamos: castigos por temporada con <em>line plots</em></h2>

<p>De las gráficas básicas me faltaba hacer un <em>line plot</em> asi que pensé que graficar el número de castigos por temporada sería una buena idea.</p>

<p>Así quedó el ejercicio en <strong>ggplot:</strong></p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigosAllSeason.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigosAllSeason.png?raw=true" /></p>

<p>Y así el de <strong>Altair:</strong></p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigosAllSeason.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigosAllSeason.png?raw=true" /></p>

<p>Veamos como se hicieron los dataframes:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## R dataframe ##</span><span class="w">
</span><span class="n">df_temporada_help_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="n">week</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="p">,</span><span class="n">penalty_side</span><span class="p">,</span><span class="n">game_type</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarise</span><span class="p">(</span><span class="n">cnt_pen_game</span><span class="o">=</span><span class="n">n</span><span class="p">(),</span><span class="w">
              </span><span class="n">pats_points_game</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">pats_points</span><span class="p">),</span><span class="w">
              </span><span class="n">opp_points_game</span><span class="o">=</span><span class="n">mean</span><span class="p">(</span><span class="n">opps_points</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">group_by</span><span class="p">(</span><span class="n">season</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="p">,</span><span class="n">penalty_side</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">summarise</span><span class="p">(</span><span class="n">sum_pen_season</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">cnt_pen_game</span><span class="p">),</span><span class="w">
              </span><span class="n">opp_points_season</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">opp_points_game</span><span class="p">))</span><span class="w">
  
  </span><span class="c1">#Crear columna para unir el tipo de castigo y quién lo hizo</span><span class="w">
  </span><span class="n">df_temporada_help_all</span><span class="o">$</span><span class="n">cat_made</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="n">df_temporada_help_all</span><span class="o">$</span><span class="n">team_penalty_cat</span><span class="p">,</span><span class="n">df_temporada_help_all</span><span class="o">$</span><span class="n">penalty_side</span><span class="p">)</span><span class="w">
  
</span></code></pre></div></div>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Pandas dataframe ##
</span><span class="n">df_temporada_help</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"season"</span><span class="p">,</span><span class="s">"week"</span><span class="p">,</span><span class="s">"team_penalty_cat"</span><span class="p">,</span><span class="s">"penalty_side"</span><span class="p">,</span><span class="s">"game_type"</span><span class="p">]).</span><span class="n">agg</span><span class="p">(</span>\
                                                                              <span class="n">pats_points_game</span> <span class="o">=</span> <span class="p">(</span><span class="s">'pats_points'</span><span class="p">,</span><span class="s">'mean'</span><span class="p">),</span>
                                                                              <span class="n">opp_points_game</span> <span class="o">=</span> <span class="p">(</span><span class="s">'opps_points'</span><span class="p">,</span><span class="s">'mean'</span><span class="p">),</span>
                                                                              <span class="n">cnt_pen_game</span> <span class="o">=</span> <span class="p">(</span><span class="s">'opps_points'</span><span class="p">,</span><span class="s">'count'</span><span class="p">),</span>
                                     <span class="p">).</span><span class="n">reset_index</span><span class="p">().</span><span class="n">groupby</span><span class="p">([</span><span class="s">"season"</span><span class="p">,</span><span class="s">"penalty_side"</span><span class="p">,</span><span class="s">"team_penalty_cat"</span><span class="p">]).</span><span class="n">agg</span><span class="p">(</span>\
                                                                                                          <span class="n">sum_pen_season</span> <span class="o">=</span> <span class="p">(</span><span class="s">'cnt_pen_game'</span><span class="p">,</span><span class="s">'sum'</span><span class="p">),</span>
                                                                                                          <span class="n">opp_points_season</span><span class="o">=</span> <span class="p">(</span><span class="s">'opp_points_game'</span><span class="p">,</span><span class="s">'sum'</span><span class="p">)</span>
                                                                                                  <span class="p">).</span><span class="n">reset_index</span><span class="p">()</span>


<span class="c1">#Crear columna para unir el tipo de castigo y quién lo hizo
</span><span class="n">df_temporada_help</span><span class="p">[</span><span class="s">"cat_made"</span><span class="p">]</span><span class="o">=</span><span class="n">df_temporada_help</span><span class="p">[</span><span class="s">"team_penalty_cat"</span><span class="p">]</span><span class="o">+</span><span class="s">' '</span><span class="o">+</span><span class="n">df_temporada_help</span><span class="p">[</span><span class="s">"penalty_side"</span><span class="p">]</span>
<span class="n">df_temporada_help</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

</code></pre></div></div>
<p>En ambos casos concatené las agrupaciones y al final hice una nueva columna (<code class="language-plaintext highlighter-rouge">cat_made</code>) en el dataframe para concatenar el tipo de castigo con el equipo castigado.</p>

<p>Ahora veamos el código de <strong>ggplot</strong></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">directlabels</span><span class="p">)</span><span class="w">

</span><span class="n">plot_temporada_all</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">df_temporada_help_all</span><span class="p">,</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">season</span><span class="p">,</span><span class="w">
                                   </span><span class="n">y</span><span class="o">=</span><span class="n">sum_pen_season</span><span class="p">,</span><span class="w">
                                   </span><span class="n">group</span><span class="o">=</span><span class="n">cat_made</span><span class="p">))</span><span class="w">  </span><span class="o">+</span><span class="w">
    </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cat_made</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="n">sum_pen_season</span><span class="p">),</span><span class="w">
              </span><span class="n">show.legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w">
              </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.8</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">geom_dl</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cat_made</span><span class="p">),</span><span class="w">  </span><span class="c1">#esto es de directlabels</span><span class="w">
            </span><span class="c1">#method = list(dl.trans(x = x + .2), "last.points")</span><span class="w">
            </span><span class="c1">#method = list( "smart.grid",cex=.8) </span><span class="w">
            </span><span class="c1">#method = list( "last.points",rot=30,colour="#08415C",family="mono") </span><span class="w">
            </span><span class="c1">#method="top.points"</span><span class="w">
            </span><span class="n">method</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="s2">"top.bumptwice"</span><span class="p">,</span><span class="n">colour</span><span class="o">=</span><span class="s2">"#08415C"</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s2">"mono"</span><span class="p">)</span><span class="w">
            </span><span class="c1">#method = list(dl.trans(x = x + .2), "first.points")</span><span class="w">
            </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
    </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#08415C"</span><span class="p">,</span><span class="s2">"#a5b9c3"</span><span class="p">,</span><span class="s2">"#d23051"</span><span class="p">,</span><span class="s2">"#eba3b1"</span><span class="p">))</span><span class="o">+</span><span class="w">
    </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Temporada"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Total de Castigos"</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">guides</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">labs</span><span class="p">(</span><span class="n">caption</span><span class="o">=</span><span class="s2">"@nerudista"</span><span class="p">,</span><span class="w">
         </span><span class="n">title</span><span class="o">=</span><span class="s2">"Castigos por Temporada - ggplot"</span><span class="w">
         </span><span class="c1">#subtitle="Totales por Temporada"</span><span class="w">
    </span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme</span><span class="p">(</span><span class="w">
      </span><span class="n">legend.position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"top"</span><span class="p">,</span><span class="w">
      </span><span class="n">legend.box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"vertical"</span><span class="p">,</span><span class="w">
      </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
    </span><span class="p">)</span><span class="o">+</span><span class="w">
    </span><span class="n">theme_pats_white</span><span class="p">;</span><span class="w"> </span><span class="n">plot_temporada_all</span><span class="p">;</span><span class="w">
  
</span></code></pre></div></div>

<p>Los pasos para la gráfica fueron:</p>

<ol>
  <li>Importar la biblioteca <code class="language-plaintext highlighter-rouge">directlabels</code> para poner textos sobre la <em>line plot</em>.</li>
  <li>Definir los <code class="language-plaintext highlighter-rouge">aes()</code> de la gráfica. Aquí el truco está en <code class="language-plaintext highlighter-rouge">group=cat_made</code> para crear una línea por cada combinación de la nueva columna que creamos.</li>
  <li>Crear la capa de líneas con <code class="language-plaintext highlighter-rouge">geom_line()</code>. Usé los parámetros <code class="language-plaintext highlighter-rouge">color</code>  y <code class="language-plaintext highlighter-rouge">size</code> para asignar colores al tipo de castigo y tamaño a la línea.</li>
  <li>Generar la capa de textos con <code class="language-plaintext highlighter-rouge">geom_dl()</code>. Hay muchos métodos para colocar las etiquetas. En el código dejé varios para que puedan jugar.</li>
  <li>Asignar la escala de colores a usar con <code class="language-plaintext highlighter-rouge">scale_color_manual()</code>.</li>
  <li>Poner el título, subtítulo y caption.</li>
  <li>Aplicar el <em>theme</em> de los Pats.</li>
</ol>

<p>Ahora veamos el código de <strong>Altair:</strong></p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="s">"NE Castigo Defensivo"</span><span class="p">,</span><span class="s">"NE Castigo Ofensivo"</span><span class="p">,</span><span class="s">"Oponente Castigo Defensivo"</span><span class="p">,</span><span class="s">"Oponente Castigo Ofensivo"</span><span class="p">]</span>
<span class="n">range_</span><span class="o">=</span><span class="p">[</span><span class="s">"#08415C"</span><span class="p">,</span><span class="s">"#a5b9c3"</span><span class="p">,</span><span class="s">"#d23051"</span><span class="p">,</span><span class="s">"#eba3b1"</span><span class="p">]</span>
<span class="c1">#line_temporada_all
</span><span class="n">base_temporada_all</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_temporada_help</span><span class="p">).</span><span class="n">mark_trail</span><span class="p">().</span><span class="n">encode</span><span class="p">(</span>   <span class="c1">#trail y no line para poder cambiar el ancho de la línea
</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">"season:N"</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="s">"Temporada"</span><span class="p">,</span>
              <span class="n">axis</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">labelAngle</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span> 
    <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">"sum_pen_season:Q"</span><span class="p">,</span>
               <span class="n">title</span><span class="o">=</span><span class="s">"Total de Castigos"</span><span class="p">,</span>
               <span class="n">axis</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
               <span class="n">scale</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Scale</span> <span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="bp">False</span><span class="p">,)</span>
               <span class="p">),</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="s">"cat_made:N"</span><span class="p">,</span> 
                      <span class="n">scale</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="n">range_</span><span class="p">),</span>
                      <span class="n">legend</span><span class="o">=</span> <span class="bp">None</span><span class="p">),</span>
    <span class="n">size</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Size</span><span class="p">(</span><span class="s">"sum_pen_season:Q"</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">scale</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">18</span><span class="p">])</span>
                  <span class="p">)</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">400</span>
<span class="p">)</span>

<span class="n">base_temporada_all</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">vconcat</span><span class="p">(</span> 
             <span class="c1">#subtitle,
</span>             <span class="n">base_temporada_all</span><span class="p">,</span>
             <span class="n">caption_chart</span><span class="p">).</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">title</span><span class="o">=</span><span class="s">"Castigos Por Temporada - Altair"</span>  <span class="p">)</span>

<span class="n">base_temporada_all</span>
</code></pre></div></div>

<ol>
  <li>Crear dos listas: una para el rango y otra para el dominio de los datos. En el dominio puse los distintos valores del nuevo campo <code class="language-plaintext highlighter-rouge">cat_made</code> y en el rango puse la paleta de colores que voy a usar para cada valor.</li>
  <li>Crear la gráfica de puntos con <code class="language-plaintext highlighter-rouge">mark_trail()</code>. El truco aquí, para poder asignar tamaño a la línea, es usar <code class="language-plaintext highlighter-rouge">mark_trail()</code> y no <code class="language-plaintext highlighter-rouge">mark_line()</code>.</li>
  <li>Asignar el rango y dominio para los colores dentro del <code class="language-plaintext highlighter-rouge">scale = alt.Scale(domain=domain, range=range_)</code>.</li>
  <li>Usar <code class="language-plaintext highlighter-rouge">scale= alt.Scale(domain=[30,100], range=[1,18]</code> para jugar con el tamaño de la línea.</li>
  <li>Crear una gráfica para el <em>caption</em> (esta ya la traemos desde el inicio pero la pongo para que quede en los pasos.)</li>
  <li>Concatenar verticalmente la <em>layer chart</em> con el <em>caption</em> y el <em>subtitle</em>.</li>
  <li>Ajustar el título.</li>
</ol>

<p>Para <strong>Altair</strong> no logré poner textos sobre las gráficas pero sí logré igualar los <em>breaks</em> de los ejes aunque seguí sin poder quitar las líneas de ellos. Para ser honesto, las líneas de este úlitmo ejercicio me gustan mucho más que las de <strong>ggplot</strong> pero no poder poner etiquetas me sigue dando comezón. De nueva cuenta cualquier ayuda es bienvenida.</p>

<h2 id="mis-conclusiones">(Mis) Conclusiones</h2>

<p>Esta aventura que inició con un simple tuit se volvió un proyecto de casi mes y medio, incluyendo el tiempo de creación de estas entradas para el blog de tacos de datos. De las cosas nuevas que aprendí fue crear <em>virtual environments</em> en Anaconda, el consumir documentación de Bibliotecas, el aprender a usar funciones lambda y apply en Pandas y, por supuesto, ggplot y Altair.</p>

<p>Hacer las gráficas “base” es muy sencillo una vez que se entiende la gramática de las gráficas. En estos ejemplos eso me llevo como 1/3 del tiempo total. El resto del tiempo se me fue en buscar los elementos exactos que tenía que modificar para obtener el resultado que quería.</p>

<p>Como se habrán dado cuenta, los códigos para hacer los dataframe es muy similar en <strong>R</strong> y en <strong>Python</strong>. Cosa muy diferente en las gráficas. Ahí los códigos de <strong>Altair</strong> fueron siempre más grandes. Esto no quiere decir que sea peor o algo por el estilo. En honor a la verdad <strong>Altair</strong> siempre estuvo en desventaja porque la primera gráfica siempre la hice en <strong>ggplot</strong> y dejé que muchas cosas salieran con sus defaults que no son los mismos que en <strong>Altair</strong>. Eso significó que investigara mucho en éste para poder hacer la gráfica lo más similar a <strong>ggplot</strong>. Si lo hubiera hecho al revés, seguramente hubiera usado más líneas en <strong>ggplot</strong>. Lo que quiero decir es que no le hagan el feo a <strong>Altair</strong>. Es muy útil sobre todo si quieren moverse después a hacer gráficas con D3 y JavaScript. Hay elementos que vienen de ahí así que ya tendrían mucho contexto.</p>

<p>Otra recomendación es que le inviertan algunas horas a ver los ejemplos que hay en la documentación de ambas bibliotecas o a ver videos. Hay muchos tutoriales en internet, que me salté por desesperado, que pueden hacer muy rápido para no desgastarse tanto. Es difícil seguir adelante cuando las horas se van acumulando y el proyecto no termina. A veces esto parece carrera de resistencia.</p>

<p>Por último: diviértanse. Esto del dataviz es una chulada. Agarren un tema que les apasione, jueguen con él y compartanlo con la comunidad</p>

<h2 id="recursos">Recursos</h2>

<p>Sin la ayuda del amigo <a href="https://twitter.com/tacosdedatos">@tacosdedatos</a>, de <a href="https://twitter.com/simples_datos">Simplificando Datos</a> y de la <a href="https://twitter.com/DataVizSociety">Data Visualization Society</a> no habría terminado todo este proyecto. Dense una vuelta por sus perfiles y aprendan de todo lo que comparten.</p>

<p>El repo con las gráficas y todos los códigos están en <a href="https://github.com/nerudista/DataViz/tree/master/Pats">https://github.com/nerudista/DataViz/tree/master/Pats</a>. 
Siéntanse libre de jugar con él.
***</p>

<p>¿Qué te pareció la nota? <a href="https://twitter.com/share?text=Obvio+que+estuvo+bien+chido+el+blog+%40tacosdedatos+%F0%9F%8C%AE">Mandanos un tuit a @tacosdedatos</a> o <a href="https://twitter.com/share?text=Obvio+que+estuvo+bien+chidote+el+blog+%40tacosdedatos+y+%40nerudista+%F0%9F%8C%AE">a @nerudista</a> o envianos un correo a <a href="mailto:sugerencias@tacosdedatos.com?subject=Sugerencia&amp;body=Hola-holaaa">✉️ sugerencias@tacosdedatos.com</a>. Y recuerda que puedes subscribirte a nuestro boletín semanal aquí debajo.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscríbete a 🌮 tacos de datos | Aprende visualización de datos en español.</h3>
                    <p>Recibe las mejores publicaciones directamente a tu caja de entrada</p>
                    <div id="revue-embed">
  <form
    action="http://boletin.tacosdedatos.com/add_subscriber"
    method="post"
    id="revue-form"
    name="revue-form"
    target="_blank"
  >
    <div class="revue-form-group">
      <div>
        <label for="member_email">Correo electrónico</label>
        <input
          class="revue-form-field"
          placeholder="Tu correo electrónico"
          type="email"
          name="member[email]"
          id="member_email"
        />
      </div>
      <div class="revue-form-group">
        <label for="member_first_name"
          >Nombre <span class="optional">(Opcional)</span></label
        >
        <input
          class="revue-form-field"
          placeholder="Nombre (opcional)"
          type="text"
          name="member[first_name]"
          id="member_first_name"
        />
      </div>
      <div class="revue-form-group">
        <label for="member_last_name"
          >Apellidos <span class="optional">(Opcional)</span></label
        >
        <input
          class="revue-form-field"
          placeholder="Apellidos (opcional)"
          type="text"
          name="member[last_name]"
          id="member_last_name"
        />
      </div>
      <div class="revue-form-actions">
        <input
          type="submit"
          value="Subscribe"
          name="member[subscribe]"
          id="member_submit"
        />
      </div>
    </div>
    <div class="revue-form-footer">
      Al registrarte declaras aceptar los
      <a target="_blank" href="https://www.getrevue.co/terms"
        >términos y condiciones de uso</a
      >
      y la
      <a target="_blank" href="https://www.getrevue.co/privacy"
        >política de privacidad</a
      >
      de Revue.
    </div>
  </form>
</div>

                </section>
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/yo_nerudista.jpg" alt="nerudista" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/nerudista">Pablo Quetzalcóatl Vázquez</a></h4>
                                
                                    <p>Me encantan los datos y los deportes. Aprendiz eterno de BI, Dataviz y ahora de Python y R. También entrenador de Triatlón por si ocupan.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/nerudista">Lee Más</a>
                        </div>
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair-Parte-II';
                            this.page.identifier = 'Primeros pasos con ggplot (R) y Altair (Python) - Parte II';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://tacosdedatos.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.png)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; 🌮 tacos de datos | Aprende visualización de datos en español. &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/blog/">Blog</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/sidetable-el-beffo-de-pandas">Sidetable, el beffo de pandas</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/Dueno-de-mis-Datos-Facebook-Parte-III">Dueño de mis datos - Capítulo Facebook - Parte III</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/Dueno-de-mis-Datos-Facebook-Parte-II">Dueño de mis datos - Capítulo Facebook - Parte II</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/blog/">
                                
                                    See all 22 posts  →
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/Elementos-de-diseno-y-analisis-en-la-visualizacion-de-datos">
                <div class="post-card-image" style="background-image: url(/assets/articulos/001.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/Elementos-de-diseno-y-analisis-en-la-visualizacion-de-datos">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Artículos</span>
                            
                        
                            
                               <span class="post-card-tags">Visualización de datos</span>
                            
                        
                            
                               <span class="post-card-tags">Análisis</span>
                            
                        
                            
                               <span class="post-card-tags">Diseño gráfico</span>
                            
                        
                            
                                <span class="post-card-tags">Comunicación eficaz</span>
                            
                        
                    

                    <h2 class="post-card-title">Elementos de diseño y análisis en la visualización de datos</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/yo_bilal.png" alt="Bilal Laouah Bakkali" />
                        
                        <span class="post-card-author">
                            <a href="/author/bilal/">Bilal Laouah Bakkali</a>
                        </span>
                    
                
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/Primeros-pasos-con-ggplot-y-altair">
                <div class="post-card-image" style="background-image: url(/assets/blogposts/009.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/Primeros-pasos-con-ggplot-y-altair">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Blog</span>
                            
                        
                            
                               <span class="post-card-tags">Altair</span>
                            
                        
                            
                               <span class="post-card-tags">Ggplot2</span>
                            
                        
                            
                               <span class="post-card-tags">Python</span>
                            
                        
                            
                                <span class="post-card-tags">R</span>
                            
                        
                    

                    <h2 class="post-card-title">Primeros pasos con ggplot (R) y Altair (Python)</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/yo_nerudista.jpg" alt="Pablo Quetzalcóatl Vázquez" />
                        
                        <span class="post-card-author">
                            <a href="/author/nerudista/">Pablo Quetzalcóatl Vázquez</a>
                        </span>
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://old.tacosdedatos.com/">
            
                <img src="/assets/icons/favicon.ico" alt="🌮 tacos de datos | Aprende visualización de datos en español. icon" />
            
            <span>🌮 tacos de datos | Aprende visualización de datos en español.</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Primeros pasos con ggplot (R) y Altair (Python) - Parte II</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">comparte esto <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Primeros+pasos+con+ggplot+%28R%29+y+Altair+%28Python%29+-+Parte+II&amp;url=https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair-Parte-II"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair-Parte-II"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://old.tacosdedatos.com/">🌮 tacos de datos | Aprende visualización de datos en español.</a> &copy; 2021</section>
                <section class="poweredby">Publicado con <a href="https://jekyllrb.com/">Jekyll</a>, código abierto en 
                    <a href="https://github.com/tacosdedatos/website" target="_blank" rel="noopener">GitHub</a> usando
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">lo <b>+</b> nuevo</a>
                    <a href="https://tacosdedatos.com/etiquetas" target="_blank" rel="noopener">etiquetas</a>
                    <!-- <a href="https://facebook.com/tacosdedatos" target="_blank" rel="noopener">Facebook</a> -->
                    <!-- <a href="https://twitter.com/tacosdedatos" target="_blank" rel="noopener">Twitter</a> -->
                    <a href="https://instagram.com/chekos.visuals" target="_blank" rel="noopener">instagram</a>
                    
                    <a href="https://join.slack.com/t/tacosdedatos/shared_invite/enQtNTQyOTE3NzE5NDE1LTA2MWZhMGE3NzNhYTA0Yjc1Yjk0NTZjNzM4M2VjOGIzOTA4YTc2ZjlkYjIyODRmYjA0MjVlMjExNjRjYWQ0NDQ" target="_blank" rel="noopener">slack</a>
                    <a href="https://patreon.com/tacosdedatos/" target="_blank" rel="noopener">patreon</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                    <img class="subscribe-overlay-logo" src="/assets/images/alt-blog-icon.png" alt="🌮 tacos de datos | Aprende visualización de datos en español." />
                
                <h1 class="subscribe-overlay-title">Subscríbete a 🌮 tacos de datos | Aprende visualización de datos en español.</h1>
                <p class="subscribe-overlay-description">¡Mantente al tanto! Recibe las mejores publicaciones directamente a tu caja de entrada.</p>
                <div id="revue-embed">
  <form
    action="http://boletin.tacosdedatos.com/add_subscriber"
    method="post"
    id="revue-form"
    name="revue-form"
    target="_blank"
  >
    <div class="revue-form-group">
      <div>
        <label for="member_email">Correo electrónico</label>
        <input
          class="revue-form-field"
          placeholder="Tu correo electrónico"
          type="email"
          name="member[email]"
          id="member_email"
        />
      </div>
      <div class="revue-form-group">
        <label for="member_first_name"
          >Nombre <span class="optional">(Opcional)</span></label
        >
        <input
          class="revue-form-field"
          placeholder="Nombre (opcional)"
          type="text"
          name="member[first_name]"
          id="member_first_name"
        />
      </div>
      <div class="revue-form-group">
        <label for="member_last_name"
          >Apellidos <span class="optional">(Opcional)</span></label
        >
        <input
          class="revue-form-field"
          placeholder="Apellidos (opcional)"
          type="text"
          name="member[last_name]"
          id="member_last_name"
        />
      </div>
      <div class="revue-form-actions">
        <input
          type="submit"
          value="Subscribe"
          name="member[subscribe]"
          id="member_submit"
        />
      </div>
    </div>
    <div class="revue-form-footer">
      Al registrarte declaras aceptar los
      <a target="_blank" href="https://www.getrevue.co/terms"
        >términos y condiciones de uso</a
      >
      y la
      <a target="_blank" href="https://www.getrevue.co/privacy"
        >política de privacidad</a
      >
      de Revue.
    </div>
  </form>
</div>

            </div>
        </div>
    

    <!-- highlight.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script> -->
    <script src="/assets/js/highlight.pack.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
        });
    });
    </script>
    <!-- prism.js -->
    <!-- <script type="text/javascript" src="/assets/js/prism.js"></script> -->
    

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>

    <!-- <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script> -->


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-133541532-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
