<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Primeros pasos con ggplot (R) y Altair (Python)</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/custom.css" />
    <!-- <link rel="stylesheet" type="text/css" href="/assets/built/prism.css" /> -->
    <!-- highlight.js -->
    <!-- <link rel="stylesheet" href="/assets/built/styles/default.css"> -->
    <style>.hljs { background: none; }</style>
    <!-- night owl style  -->
    <link rel="stylesheet" href="/assets/built/styles/night-owl.css" />
    <style type='text/css'>
        pre, code {
            white-space: pre-wrap;
            overflow-x: scroll;
        }
        .hljs {
            display: inline-block;
            overflow-x: scroll;
            min-width: 100%;
        }
        .highlight {
            min-width: 100%;
        }
        div[class^="language-"] {
            min-width: 100%;
        }
    </style>

    

    



    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="Tu sitio para aprender de visualizaci√≥n y ciencia de datos en espa√±ol. Consejos, recursos y mejores pr√°cticas para tus proyectos de tecnolog√≠a, periodismo de datos y an√°lisis estad√≠sticos." />
    <link rel="shortcut icon" href="https://old.tacosdedatos.com/assets/icons/favicon.ico" type="image/png" />
    <link rel="canonical" href="https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol." />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Primeros pasos con ggplot (R) y Altair (Python)" />
    <meta property="og:description" content="Hace un par de meses, mientras ve√≠a el partido de los Pats contra los Cowboys, un tuitero famos√≥n mencion√≥ que a los Pats siempre los benefician los arbitros. Por esas fechas le√≠a un libro sobre sesgos cognitivos y pens√© que tal vez habr√≠a un tanto de eso con los Pats." />
    <meta property="og:url" content="https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair" />
    <meta property="og:image" content="https://old.tacosdedatos.com/assets/blogposts/009.png" />
    <meta property="article:publisher" content="https://www.facebook.com/tacosdedatos" />
    <meta property="article:author" content="https://www.facebook.com/tacosdedatos" />
    <meta property="article:published_time" content="2020-01-04T10:00:00+00:00" />
    <meta property="article:modified_time" content="2020-01-04T10:00:00+00:00" />
    <meta property="article:tag" content="Blog" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Primeros pasos con ggplot (R) y Altair (Python)" />
    <meta name="twitter:description" content="Hace un par de meses, mientras ve√≠a el partido de los Pats contra los Cowboys, un tuitero famos√≥n mencion√≥ que a los Pats siempre los benefician los arbitros. Por esas fechas le√≠a un libro sobre sesgos cognitivos y pens√© que tal vez habr√≠a un tanto de eso con los Pats." />
    <meta name="twitter:url" content="https://old.tacosdedatos.com/" />
    <meta name="twitter:image" content="https://old.tacosdedatos.com/assets/blogposts/009.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol." />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Blog" />
    <meta name="twitter:site" content="@tacosdedatos" />
    <meta name="twitter:creator" content="@tacosdedatos" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol.",
        "logo": "https://old.tacosdedatos.com/assets/images/alt-blog-icon.png"
    },
    "url": "https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair",
    "image": {
        "@type": "ImageObject",
        "url": "https://old.tacosdedatos.com/assets/blogposts/009.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair"
    },
    "description": "Hace un par de meses, mientras ve√≠a el partido de los Pats contra los Cowboys, un tuitero famos√≥n mencion√≥ que a los Pats siempre los benefician los arbitros. Por esas fechas le√≠a un libro sobre sesgos cognitivos y pens√© que tal vez habr√≠a un tanto de eso con los Pats."
}
    </script>

    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Primeros pasos con ggplot (R) y Altair (Python)" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="https://old.tacosdedatos.com/"><img src="/assets/images/alt-blog-icon.png" alt="üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol." /></a>
            
        
        
            <ul class="nav" role="menu">
    <li class="nav-home" role="menuitem"><a href="/">inicio</a></li>
    <li class="nav-home" role="menuitem"><a href="https://medium.com/tacosdedatos/">la publiqueishon (Medium)</a></li>
    <li class="nav-about" role="menuitem"><a href="/sobre/">sobre üåÆ</a></li>
    <li class="nav-podcast" role="menuitem"><a href="https://tacosdedatos.fm">podcast üåÆüéß</a></li>
    <li class="nav-recursos" role="menuitem"><a href="http://boletin.tacosdedatos.com/">el bolet√≠n</a></li>
</ul>

        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
                <a class="social-link social-link-fb" href="https://facebook.com/tacosdedatos" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
</a>
            
            
                <a class="social-link social-link-tw" href="https://twitter.com/tacosdedatos" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
            
        </div>
        
            <a class="subscribe-button" href="#subscribe">Subscr√≠bete</a>
        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-blog ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime=" 4 January 2020"> 4 January 2020</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/blog/'>BLOG</a>,
                            
                        
                            
                               <a href='/tag/altair/'>ALTAIR</a>,
                            
                        
                            
                               <a href='/tag/ggplot2/'>GGPLOT2</a>,
                            
                        
                            
                               <a href='/tag/python/'>PYTHON</a>,
                            
                        
                            
                               <a href='/tag/r/'>R</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Primeros pasos con ggplot (R) y Altair (Python)</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/assets/blogposts/009.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>Hace un par de meses, mientras ve√≠a el partido de los Pats contra los Cowboys, un tuitero famos√≥n mencion√≥ que a los Pats siempre los benefician los arbitros. Por esas fechas le√≠a un libro sobre sesgos cognitivos y pens√© que tal vez habr√≠a un tanto de eso con los Pats. As√≠ que me decid√≠ jugar un poco con los datos para ver qu√© encontraba.</p>

<p>Ten√≠a rato que quer√≠a hacer gr√°ficas con ggplot en R y con Altair en Python ya que ambas usan la <em>gram√°tica de la visualizaci√≥n</em> para crear sus gr√°ficas. Adem√°s, tengo poca experiencia con Python y R por lo que consider√© que ser√≠a un gran reto armar algo desde cero y visualizarlo usando ambas bibliotecas para poder tener un punto de comparaci√≥n.</p>

<p>En este art√≠culo intentar√© explicar c√≥mo fue mi proceso creativo y de codificaci√≥n. Como mencion√© previamente soy principiante en ambas herramientas. Por favor tengan en mente que este es mi acercamiento inicial a estas herramientas. No intento dar un manual de c√≥mo se deben hacer las cosas sino abrir la conversaci√≥n acerca de c√≥mo perderle el miedo a jugar con los datos, los retos que afront√© y las cosas que no logr√© completar.</p>

<p>Seguramente hay formas m√°s eficientes de realizar lo que se va a mostrar aqu√≠ o incluso de completar algunas tareas que no pude finalizar porque ya de plano no encontr√© documentaci√≥n o ejemplos que me pudieran ayudar.</p>

<p>Como √∫ltima advertencia les digo que no busqu√© documentaci√≥n, tutoriales ning√∫n tipo de ayuda previo a empezar a hacer las gr√°ficas.¬øPor qu√©? Dir√© que ya tenia muchas ganas de empezar a tirar c√≥digo y quer√≠a probar la documentaci√≥n existente directo en mis ejemplos para ver si la curva de aprendizaje era digerible para desesperados. Spoiler alert: no lo es.</p>

<p>Al final del art√≠culo les dejar√© algunas referencias de tutoriales y cursos que vale la pena considerar para que no sufran como un servidor.</p>

<p>Dicho esto, a darle que es mole de olla.</p>

<h2 id="armando-el-dataset">Armando el dataset</h2>

<p>Como quer√≠a analizar cosas objetivas y no subjetivas, me decid√≠ por hacer un an√°lisis de los castigos a favor y en contra de los Pats.</p>

<p>Despu√©s de buscar en internet no encontr√© un dataset con todos los datos que quer√≠a: saber el resultado del partido, qui√©n lo gan√≥, el <em>quarter</em> con su minuto y segundo cuando el castigo fue cometido, si fue castigo ofensivo o defensivo o si ese a√±o fueron campeones los Pats, entre otras cosas. As√≠ que me di a la tarea de buscar alguna API de Python que me dejara ver jugada a jugada los partidos de los Pats. Me encontr√© con la API <a href="http://nflgame.derekadair.com/"><strong>nflgame</strong></a> que me daba justo lo que quer√≠a. El √∫nico pero es que s√≥lo tiene info desde el 2009 pero consider√© que 10 a√±os era un buen per√≠odo para analizar.</p>

<p>Si bien la API tiene clases y m√©todos para dar informaci√≥n sumarizada, tuve que entrar a ver c√≥mo estaban construidas algunas clases para sacar el detalle de jugadas y no el resumen de ellas. Como el paradigma de objetos me saca ronchas tard√© como una semana en poder entender c√≥mo funcionaba pero al final obtuve un dataset de este tipo:</p>

<table>
  <thead>
    <tr>
      <th>id</th>
      <th>season</th>
      <th>home</th>
      <th>away</th>
      <th>week</th>
      <th>score_home</th>
      <th>score_away</th>
      <th>winner</th>
      <th>loser</th>
      <th>team_possesion</th>
      <th>field_position</th>
      <th>‚Ä¶</th>
      <th>team_possesion_cat</th>
      <th>team_penalty_cat</th>
      <th>penalty_side</th>
      <th>opportunity</th>
      <th>yards_to_go</th>
      <th>week_type</th>
      <th>one_posession_game</th>
      <th>pats_points</th>
      <th>opps_points</th>
      <th>game_winner_cat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>2009</td>
      <td>NE</td>
      <td>BUF</td>
      <td>1</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
      <td>BUF</td>
      <td>BUF</td>
      <td>BUF 43</td>
      <td>‚Ä¶</td>
      <td>Oponente</td>
      <td>Oponente</td>
      <td>Castigo Ofensivo</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>1</td>
      <td>Juego de una posesi√≥n</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
    </tr>
    <tr>
      <td>1</td>
      <td>2009</td>
      <td>NE</td>
      <td>BUF</td>
      <td>1</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
      <td>BUF</td>
      <td>NE</td>
      <td>NE 30</td>
      <td>‚Ä¶</td>
      <td>NE</td>
      <td>NE</td>
      <td>Castigo Ofensivo</td>
      <td>2.0</td>
      <td>8.0</td>
      <td>1</td>
      <td>Juego de una posesi√≥n</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2009</td>
      <td>NE</td>
      <td>BUF</td>
      <td>1</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
      <td>BUF</td>
      <td>NE</td>
      <td>NE 45</td>
      <td>‚Ä¶</td>
      <td>NE</td>
      <td>Oponente</td>
      <td>Castigo Defensivo</td>
      <td>1.0</td>
      <td>10.0</td>
      <td>1</td>
      <td>Juego de una posesi√≥n</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
    </tr>
    <tr>
      <td>3</td>
      <td>2009</td>
      <td>NE</td>
      <td>BUF</td>
      <td>1</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
      <td>BUF</td>
      <td>BUF</td>
      <td>BUF 48</td>
      <td>‚Ä¶</td>
      <td>Oponente</td>
      <td>NE</td>
      <td>Castigo Defensivo</td>
      <td>1.0</td>
      <td>10.0</td>
      <td>1</td>
      <td>Juego de una posesi√≥n</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
    </tr>
    <tr>
      <td>4</td>
      <td>2009</td>
      <td>NE</td>
      <td>BUF</td>
      <td>1</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
      <td>BUF</td>
      <td>BUF</td>
      <td>NE 43</td>
      <td>‚Ä¶</td>
      <td>Oponente</td>
      <td>Oponente</td>
      <td>Castigo Ofensivo</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1</td>
      <td>Juego de una posesi√≥n</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
    </tr>
    <tr>
      <td>5</td>
      <td>2009</td>
      <td>NE</td>
      <td>BUF</td>
      <td>1</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
      <td>BUF</td>
      <td>NE</td>
      <td>NE 26</td>
      <td>‚Ä¶</td>
      <td>NE</td>
      <td>Oponente</td>
      <td>Castigo Defensivo</td>
      <td>4.0</td>
      <td>16.0</td>
      <td>1</td>
      <td>Juego de una posesi√≥n</td>
      <td>25</td>
      <td>24</td>
      <td>NE</td>
    </tr>
  </tbody>
</table>

<p>En total, haciendo apr√≥x. una hora diaria, me tarde como 10-12 d√≠as en poder tener el c√≥digo que me serv√≠a. ¬øCosas que aprend√≠? Listas, funciones, lambdas y m√°s pandas.</p>

<p>El c√≥digo para replicar la obtenci√≥n del dataset lo encuentran aqu√≠:</p>

<p>https://github.com/nerudista/DataViz/blob/master/Pats/get_pats_data.ipynb</p>

<h2 id="a-graficar-se-ha-dicho">A graficar se ha dicho</h2>

<p>Como todo principiante me emocion√© y empec√© a visualizar. Al no saber como crear las gr√°ficas busqu√© en blogs y en documentacion de <strong>ggplot</strong>. Ah√≠ perd√≠ como 3 d√≠as porque me ocup√© m√°s en <em><strong>c√≥mo</strong></em> visualizar y no en <em><strong>qu√©</strong></em> visualizar.</p>

<p>Regresando a lo que mandan los c√°nones tom√© papel y lapiz y me puse a tirar ideas y bocetos de qu√© quer√≠a comunicar. Este es un ejemplo:</p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/ideas/boceto1.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/ideas/boceto1.png?raw=true" /></p>

<p>Perd√≥n por los jerogl√≠ficos. El pdf con las dem√°s ideas est√° aca:</p>

<p>https://github.com/nerudista/DataViz/blob/master/Pats/ideas/Pats%20an%C3%A1lisis%202019-12-15.pdf</p>

<h2 id="creando-themes">Creando <em>themes</em></h2>

<p>Durante los d√≠as que di batazos de ciego encontr√© un gran <a href="https://towardsdatascience.com/consistently-beautiful-visualizations-with-altair-themes-c7f9f889602">art√≠culo</a> del buen tacos de datos acerca de crear plantillas de dise√±o para darle agilidad y consistencia a la creaci√≥n de gr√°ficas.</p>

<p>Estas plantillas se llaman <em>themes</em> y pueden crearse tanto para ggplot como para Altair.</p>

<p>Este es el que cre√© para <strong>ggplot</strong>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">theme_pats_white</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">theme</span><span class="p">(</span><span class="w">
  
  </span><span class="n">text</span><span class="o">=</span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">12</span><span class="p">,</span><span class="w">
                    </span><span class="n">family</span><span class="o">=</span><span class="s2">"mono"</span><span class="p">,</span><span class="w">
                    </span><span class="n">color</span><span class="o">=</span><span class="s2">"#002145"</span><span class="p">),</span><span class="w">
  </span><span class="c1"># limpiar la gr√°fica</span><span class="w">
  </span><span class="n">axis.ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
  </span><span class="c1"># ajustar titulos y notas</span><span class="w">
  </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">20</span><span class="p">,</span><span class="w">
                            </span><span class="c1">#family = "mono",</span><span class="w">
                            </span><span class="n">color</span><span class="o">=</span><span class="s2">"#08415C"</span><span class="w">
                            </span><span class="p">),</span><span class="w">
  </span><span class="n">plot.caption</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="w">
                            </span><span class="n">color</span><span class="o">=</span><span class="s2">"#08415C"</span><span class="p">,</span><span class="w">
                            </span><span class="n">face</span><span class="o">=</span><span class="s2">"italic"</span><span class="p">,</span><span class="w">
                            </span><span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="w">
                            </span><span class="p">),</span><span class="w">
  </span><span class="c1"># Hide panel borders and remove grid lines</span><span class="w">
  </span><span class="n">panel.border</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
  </span><span class="n">panel.grid.major</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
  </span><span class="n">panel.background</span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
  </span><span class="n">panel.grid.minor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">(),</span><span class="w">
  
  </span><span class="c1"># legend color</span><span class="w">
  </span><span class="n">legend.background</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s1">'#FFFFFF'</span><span class="p">),</span><span class="w">
  </span><span class="c1">#legend.position = "top",</span><span class="w">
  </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_text</span><span class="p">(</span><span class="w">
    </span><span class="n">color</span><span class="o">=</span><span class="s2">"#08415C"</span><span class="p">),</span><span class="w"> 
  </span><span class="n">legend.key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s2">"#FFFFFF"</span><span class="p">),</span><span class="w">     </span><span class="c1">#quita el color gris de la l√≠nea de castigos  </span><span class="w">
  </span><span class="n">legend.spacing.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unit</span><span class="p">(</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
  </span><span class="n">legend.box.margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">margin</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="s2">"cm"</span><span class="p">),</span><span class="w">
  </span><span class="n">complete</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="w">
  </span><span class="p">)</span><span class="w">

</span></code></pre></div></div>

<p>Y ac√° el de <strong>Altair</strong>:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">theme_pats_white</span><span class="p">():</span>
    <span class="c1"># Typography
</span>    <span class="n">font</span> <span class="o">=</span> <span class="s">"Courier"</span><span class="p">,</span>
    <span class="n">labelFont</span> <span class="o">=</span> <span class="s">"Courier"</span> 
    <span class="n">sourceFont</span> <span class="o">=</span> <span class="s">"Courier"</span>
    <span class="n">fontColor</span> <span class="o">=</span> <span class="s">"#08415C"</span>    <span class="c1">#Blue Pats
</span>    
    <span class="c1"># Axes
</span>    <span class="n">axisColor</span> <span class="o">=</span> <span class="s">"#000000"</span>
    <span class="n">gridColor</span> <span class="o">=</span> <span class="s">"#DEDDDD"</span>
    
    <span class="c1"># Colors
</span>    <span class="n">main_palette</span> <span class="o">=</span> <span class="p">[</span><span class="s">"#08415C"</span><span class="p">,</span> 
                    <span class="s">"#B0B7BC"</span><span class="p">,</span>
                   <span class="p">]</span>
    
    <span class="k">return</span><span class="p">{</span>        
        <span class="s">'config'</span><span class="p">:{</span>            
            <span class="s">"title"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"fontSize"</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span>
                <span class="s">"font"</span><span class="p">:</span> <span class="n">font</span><span class="p">,</span>
                <span class="s">"anchor"</span><span class="p">:</span> <span class="s">"middle"</span><span class="p">,</span> <span class="c1"># equivalent of left-aligned.                
</span>                <span class="s">"color"</span><span class="p">:</span> <span class="n">fontColor</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s">"axisX"</span><span class="p">:</span> <span class="p">{</span>  
                <span class="s">"labelFont"</span><span class="p">:</span> <span class="n">labelFont</span><span class="p">,</span>
                <span class="s">"titleFont"</span><span class="p">:</span> <span class="n">font</span><span class="p">,</span>
                <span class="s">"titleFontSize"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s">"titleColor"</span> <span class="p">:</span> <span class="n">fontColor</span><span class="p">,</span>
                <span class="s">"titleFontSize"</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
                <span class="s">"grid"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                
            <span class="p">},</span>
            <span class="s">"axisY"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"axis"</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span>
                <span class="s">"labelFont"</span><span class="p">:</span> <span class="n">labelFont</span><span class="p">,</span>
                <span class="s">"labelFontSize"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s">"titleFont"</span><span class="p">:</span> <span class="n">font</span><span class="p">,</span>
                <span class="s">"titleColor"</span> <span class="p">:</span> <span class="n">fontColor</span><span class="p">,</span>
                <span class="s">"titleFontSize"</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
                <span class="s">"grid"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s">"ticks"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
                <span class="s">"labels"</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                
            <span class="p">},</span>
            <span class="s">"legend"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"labelFont"</span><span class="p">:</span> <span class="n">labelFont</span><span class="p">,</span>
                <span class="s">"labelFontSize"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="s">"titleFont"</span><span class="p">:</span> <span class="n">font</span><span class="p">,</span>
                <span class="s">"titleFontSize"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                <span class="c1">#"titleColor" : fontColor,
</span>                <span class="s">"orient"</span><span class="p">:</span> <span class="s">"top"</span><span class="p">,</span>
                <span class="s">"title"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="c1">#"labelAlign":"center",
</span>            <span class="p">},</span>
            <span class="s">"range"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"category"</span><span class="p">:</span> <span class="n">main_palette</span><span class="p">,</span>             
            <span class="p">},</span>
            <span class="s">"view"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"stroke"</span><span class="p">:</span> <span class="s">"transparent"</span><span class="p">,</span> <span class="c1"># altair uses gridlines to box the area
</span>                                         <span class="c1">#where the data is visualized. This takes that off.
</span>            <span class="p">},</span>
            <span class="s">"facet"</span><span class="p">:{</span>
              <span class="s">"spacing"</span><span class="p">:</span><span class="mi">20</span><span class="p">,</span>  
            <span class="p">},</span>
            <span class="s">"header"</span><span class="p">:{</span>
              <span class="s">"labelColor"</span><span class="p">:</span> <span class="n">fontColor</span><span class="p">,</span>  
              <span class="c1">#"labelFont": labelFont,
</span>              <span class="s">"labelSize"</span> <span class="p">:</span> <span class="mi">10</span>
            <span class="p">},</span>

        <span class="p">}</span>
    <span class="p">}</span>


<span class="n">alt</span><span class="p">.</span><span class="n">themes</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="s">'my_custom_theme'</span><span class="p">,</span> <span class="n">theme_pats_white</span><span class="p">)</span>
<span class="n">alt</span><span class="p">.</span><span class="n">themes</span><span class="p">.</span><span class="n">enable</span><span class="p">(</span><span class="s">'my_custom_theme'</span><span class="p">)</span>
</code></pre></div></div>

<p>Ambos b√°sicamente limpian los ejes y el grid (cuadriculado de fondo), especifican la paleta de colores que voy a usar, la tipograf√≠a y las <em>legends</em> que se usan en las gr√°ficas.</p>

<p>Yo vengo del mundo de BI por lo que el formato JSON me es muy familiar. Sin embargo me gust√≥ mucho la sintaxis de <strong>R</strong>. Me parece muy limpia y ocupa menos espacio. Pr√°cticamente ocup√© 100 l√≠neas menos para conseguir algo similar.</p>

<h2 id="castigos-ofensivos-y-defensivos-con-bar-plots">Castigos Ofensivos y Defensivos con <em>Bar Plots</em></h2>

<p>Decid√≠ hacer una <em>bar plot</em> para mostrar las  yardas promedio hist√≥ricas por tipo de castigo.</p>

<p>Empecemos viendo el resultado en ambas #bibliotecasNoLibrerias.</p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigosOfensivos.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotCastigosOfensivos.png?raw=true" /></p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigosOfensivos.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairCastigosOfensivos.png?raw=true" /></p>

<p>En ambos casos tuve que crear un dataframe ya que agrupe por varios campos y obtuve el promedio de yardas. El c√≥digo es similar en ambos lenguajes:
R:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_yds_totales</span><span class="w"> </span><span class="o">&lt;-</span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">game_winner_cat</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="p">,</span><span class="n">penalty_side</span><span class="p">,</span><span class="n">season</span><span class="p">,</span><span class="n">week</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">sum_yds</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">penalty_yards</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">game_winner_cat</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="p">,</span><span class="n">penalty_side</span><span class="p">)</span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_yds</span><span class="o">=</span><span class="nf">round</span><span class="p">(</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">sum_yds</span><span class="p">),</span><span class="m">1</span><span class="p">))</span><span class="w">

</span></code></pre></div></div>

<p>Python:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_yds_totales_week</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"game_winner_cat"</span><span class="p">,</span><span class="s">"team_penalty_cat"</span><span class="p">,</span><span class="s">"penalty_side"</span><span class="p">,</span>\
                               <span class="s">"season"</span><span class="p">,</span><span class="s">"week"</span><span class="p">])[</span><span class="s">"penalty_yards"</span><span class="p">].</span><span class="nb">sum</span><span class="p">().</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"sum_yds"</span><span class="p">)</span>


<span class="n">df_yds_totales</span> <span class="o">=</span> <span class="n">df_yds_totales_week</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"game_winner_cat"</span><span class="p">,</span><span class="s">"team_penalty_cat"</span><span class="p">,</span> \
                                              <span class="s">"penalty_side"</span><span class="p">])[</span><span class="s">"sum_yds"</span><span class="p">].</span><span class="n">mean</span><span class="p">().</span><span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"mean_yds"</span><span class="p">)</span>


</code></pre></div></div>

<p>Yo estoy muy enamorado de Pandas pero el operador  <code class="language-plaintext highlighter-rouge">%&gt;%</code> se me hizo una chulada.</p>

<p>La primer gr√°fica la hice con R. Este es el c√≥digo de <strong>ggplot</strong> para crear la gr√°fica:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">##### Gr√°fica de castigos ofensivos</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df_yds_totales</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">penalty_side</span><span class="o">==</span><span class="s1">'Castigo Ofensivo'</span><span class="p">),</span><span class="w">
       </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">game_winner_cat</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">mean_yds</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">team_penalty_cat</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="w"> </span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">paste</span><span class="p">(</span><span class="n">mean_yds</span><span class="p">,</span><span class="s2">" yds"</span><span class="p">)),</span><span class="w">
            </span><span class="n">position</span><span class="o">=</span><span class="n">position_dodge</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">.9</span><span class="p">),</span><span class="w">
            </span><span class="n">family</span><span class="o">=</span><span class="s2">"mono"</span><span class="p">,</span><span class="w">
            </span><span class="n">color</span><span class="o">=</span><span class="s2">"#08415C"</span><span class="p">,</span><span class="w">
            </span><span class="n">size</span><span class="o">=</span><span class="m">3.5</span><span class="p">,</span><span class="w">
            </span><span class="n">vjust</span><span class="o">=</span><span class="m">-0.5</span><span class="w">                       </span><span class="c1">#separacion vertical de la barra</span><span class="w">
            </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">  
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Castigos Ofensivos por Equipo - ggplot"</span><span class="p">,</span><span class="w">
          </span><span class="n">caption</span><span class="o">=</span><span class="s2">"@nerudista"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">guide_legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">NULL</span><span class="p">))</span><span class="o">+</span><span class="w">      </span><span class="c1">#remove legend title</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Cuando Pats Ganan"</span><span class="p">,</span><span class="s2">"Cuando Pats Pierden"</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NULL</span><span class="p">,</span><span class="w">          </span><span class="c1">#remove y breaks lines</span><span class="w">
                     </span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">31</span><span class="p">))</span><span class="o">+</span><span class="w">    </span><span class="c1">#cambiar rango del eje Y       </span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="w">
                    </span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#08415C"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#B0B7BC"</span><span class="p">)</span><span class="w">
                    </span><span class="c1">#labels=c("NE","Oponente")</span><span class="w">
                    </span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Promedio de Yardas\n Concedidas Por Partido"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">theme_pats_white</span><span class="o">+</span><span class="w">
</span><span class="n">theme</span><span class="p">(</span><span class="w">
  </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>B√°sicamente la secuencia de pasos de <strong>ggplot</strong> fue:</p>

<ol>
  <li>Filtrar dentro de ggplot el tipo de castigo</li>
  <li>Definir los aes() de la gr√°fica</li>
  <li>Crear la gr√°fica de barra</li>
  <li>Sobre la anterior crear la gr√°fica para los textos arriba de las barras</li>
  <li>Cambiar las etiquetas ‚ÄúCuando ganan ..‚Äù</li>
  <li>Aplicar el <em>theme</em> que definimos al inicio.</li>
  <li>Generar el titulo y el <em>caption</em></li>
</ol>

<p>Hacer esta gr√°fica fue relativamente f√°cil. Me tard√© poco m√°s de una hora porque investigu√©  el tema del <code class="language-plaintext highlighter-rouge">position = "dodge" </code> , c√≥mo quitar el t√≠tulo de la leyenda y l√≠mites del eje Y.</p>

<p>Para  <strong>Altair</strong> la cosa se puso m√°s interesante ya que tuve que usar un <strong>transform_filter</strong> para quedarme s√≥lo con los castigos ofensivos y adem√°s usar un <strong>transform_calculate</strong> para generar un nuevo campo ya que no puedo cambiar los labels (‚ÄúCuando los Pats ‚Ä¶‚Äù) como en <strong>ggplot</strong>. Despu√©s tuve que investigar c√≥mo usar el <strong>facet</strong> para ‚Äúduplicar‚Äù la gr√°fica por el campo que reci√©n hab√≠a creado. Por √∫ltimo tuve que investigar c√≥mo crear un <em>caption</em>. Tard√© como unas 6-7 horas batallando con estos temas. Si se van a meter a Altair, invi√©rtanle un tiempo previo para que no se desgasten como yo.</p>

<p>El c√≥digo de Python qued√≥ as√≠:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#primer intento ofensivos
</span><span class="kn">from</span> <span class="nn">altair.expr</span> <span class="kn">import</span> <span class="n">datum</span><span class="p">,</span> <span class="n">if_</span>

<span class="n">barOf</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_yds_totales</span><span class="p">).</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="s">"datum.penalty_side == 'Castigo Ofensivo'"</span>
  <span class="p">).</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">Genus</span><span class="o">=</span><span class="s">'indexof(["NE"], datum.game_winner_cat) &gt;= 0 ? "Cuando los Pats Ganan": "Cuando los Pats Pierden"'</span>
<span class="p">).</span><span class="n">mark_bar</span><span class="p">().</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">'team_penalty_cat:N'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">''</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">'mean(mean_yds):Q'</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">'Promedio de Yardas</span><span class="se">\n</span><span class="s">Concedidas por Partido'</span><span class="p">),</span>    
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="s">'team_penalty_cat:N'</span> <span class="p">,</span> 
                    <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s">"horizontal"</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span><span class="n">legendX</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">legendY</span><span class="o">=-</span><span class="mi">50</span><span class="p">))</span>
<span class="p">)</span>


<span class="n">textOf</span> <span class="o">=</span> <span class="n">barOf</span><span class="p">.</span><span class="n">mark_text</span><span class="p">(</span><span class="n">dx</span><span class="o">=</span><span class="mi">0</span> <span class="p">,</span><span class="n">dy</span><span class="o">=-</span><span class="mi">8</span><span class="p">,</span> <span class="n">fontSize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s">"Courier"</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#08415C"</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Text</span><span class="p">(</span> <span class="s">"mean(mean_yds):Q"</span> <span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s">".1f"</span><span class="p">,),</span>   <span class="c1">#redondear decimales en el label
</span>    <span class="n">opacity</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.9</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">base_castigos_ofensivos</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">layer</span><span class="p">(</span><span class="n">barOf</span><span class="p">,</span> <span class="n">textOf</span><span class="p">).</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">250</span><span class="p">,</span>
<span class="p">).</span><span class="n">facet</span><span class="p">(</span>
    <span class="n">column</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Column</span><span class="p">(</span><span class="s">"Genus:N"</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">""</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">finalOf</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">vconcat</span><span class="p">(</span><span class="n">base_castigos_ofensivos</span><span class="p">,</span> <span class="n">caption_chart</span><span class="p">).</span><span class="n">configure_header</span><span class="p">(</span>    
    <span class="c1">#El configure header va aqu√≠ para evitar errores de config
</span>    <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">labelOrient</span><span class="o">=</span><span class="s">"bottom"</span><span class="p">,</span>  <span class="c1">#Posici√≥n del "Cuando los Pats ganan",
</span>    <span class="n">labelFontSize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>    <span class="c1">#Tama√±o del "Cuando los Pats ganan",
</span>    <span class="n">labelFont</span><span class="o">=</span><span class="s">"Courier"</span><span class="p">,</span>
    
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
 <span class="n">title</span> <span class="o">=</span> <span class="s">"Castigos Ofensivos Por Equipo - Altair"</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">finalOf</span> <span class="o">=</span> <span class="n">finalOf</span><span class="p">.</span><span class="n">configure_title</span><span class="p">(</span>
    <span class="n">anchor</span><span class="o">=</span><span class="s">'start'</span>
<span class="p">)</span>

<span class="n">finalOf</span>
</code></pre></div></div>

<p>En <strong>Altair</strong> tuve que seguir la siguiente l√≥gica:</p>
<ol>
  <li>Crear chart</li>
  <li>Filtrar dentro de Altair el tipo de castigo</li>
  <li>Crear un nuevo campo para generar el label ‚ÄúCuando ganan ..‚Äù</li>
  <li>Crear la gr√°fica de barra</li>
  <li>Crear otra gr√°fica para los textos arriba de las barras</li>
  <li>Hacer una <em>layer chart</em> para unir las dos anteriores</li>
  <li>Hacer una <em>facet chart</em> para duplicar la gr√°fica por la variable que cre√© al inicio</li>
  <li>Crear una gr√°fica para el <em>caption</em></li>
  <li>Concatenar verticalmente la <em>facet chart</em> con el <em>caption</em></li>
  <li>Ajustar el header para que los labels de la <em>facet chart</em>  queden por debajo el eje X</li>
  <li>Ajustar el t√≠tulo</li>
</ol>

<p>Me cost√≥ bastante entender la secuencia layer ‚Äì&gt; facet ‚Äì&gt; concat. Si no la segu√≠a bien, este error se reproduc√≠a como conejo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ValueError: Objects with "config" attribute cannot be used within LayerChart. Consider defining the config attribute in the LayerChart object instead.

</code></pre></div></div>

<p>En <strong>Altair</strong> no logr√© quitar el eje Y por completo. Pude quitar los labels y los ticks pero no la l√≠nea del eje. Adem√°s, no permite saltos de l√≠nea en el t√≠tulo del eje, cosa que se arregla con un <code class="language-plaintext highlighter-rouge">\n</code> en <strong>ggplot</strong></p>

<p>Como mencion√© anteriormente, una de las cosas m√°s complicadas que tuve en <strong>Altair</strong> fue poner t√≠tulos y <em>captions</em> (la nota que va hasta abajo). En <em>ggplot</em> eso se logra con est√°s l√≠neas:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Castigos Ofensivos por Equipo - ggplot"</span><span class="p">,</span><span class="w">
          </span><span class="n">caption</span><span class="o">=</span><span class="s2">"@nerudista"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
</span></code></pre></div></div>

<p>Mientras que para <strong>Altair</strong> tuve que seguir otro art√≠culo del master tacos para hacer un <em>vconcat</em> :</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">finalOf</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">vconcat</span><span class="p">(</span><span class="n">base_castigos_ofensivos</span><span class="p">,</span> <span class="n">caption_chart</span><span class="p">).</span><span class="n">configure_header</span><span class="p">(</span>    
    <span class="c1">#El configure header va aqu√≠ para evitar errores de config
</span>    <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">labelOrient</span><span class="o">=</span><span class="s">"bottom"</span><span class="p">,</span>  <span class="c1">#Posici√≥n del "Cuando los Pats ganan",
</span>    <span class="n">labelFontSize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>    <span class="c1">#Tama√±o del "Cuando los Pats ganan",
</span>    <span class="n">labelFont</span><span class="o">=</span><span class="s">"Courier"</span><span class="p">,</span>
    
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
 <span class="n">title</span> <span class="o">=</span> <span class="s">"Castigos Ofensivos Por Equipo - Altair"</span><span class="p">,</span>
<span class="p">)</span>

</code></pre></div></div>
<p>Mi complicaci√≥n con el <em>vconcat</em> es que tard√© en entender que el label ‚ÄúCuando Ganan los Pats‚Äù es parte del <em>header</em> y es por eso que debo configurar el <em>labelOrient</em> en esa parte del c√≥digo.</p>

<p>En <strong>ggplot</strong> tambi√©n existe el concepto de <em>facet</em> pero para esta gr√°fica no tuve que usarla. Logr√© un efecto similar con esta parte del c√≥digo:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">game_winner_cat</span><span class="p">,</span><span class="w"> 
           </span><span class="n">y</span><span class="o">=</span><span class="n">mean_yds</span><span class="p">,</span><span class="w"> 
           </span><span class="n">fill</span><span class="o">=</span><span class="n">team_penalty_cat</span><span class="w">  </span><span class="c1">#esto pone color por equipo</span><span class="w">
           </span><span class="p">)</span><span class="w">
       </span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="w">  </span><span class="c1">#esto es similar al facet de Altair</span><span class="w">
           </span><span class="p">)</span><span class="o">+</span><span class="w">
</span></code></pre></div></div>

<p>Por √∫ltimo tengo que a√±adir que no logr√© concatenar la cadena ‚Äúyds‚Äù despu√©s del n√∫mero de yardas arriba de cada barra. Seguro es algo bien sencillo pero no logr√© darle al clavo.</p>

<h2 id="castigos-por-oportunidad-con-stack-bar-plots-horizontales">Castigos por oportunidad con <em>stack bar plots</em> horizontales</h2>

<p>Para la segunda gr√°fica intent√© hacer algo similar pero ahora con con barras horizontales y adem√°s apiladas</p>

<p>Este es el resultado de ambos ejercicios:</p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotYardasOportunidad.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/R/RplotYardasOportunidad.png?raw=true " /></p>

<p><img src="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairYardasOportunidad.png?raw=true" alt="https://github.com/nerudista/DataViz/blob/master/Pats/graficas/Altair/AltairYardasOportunidad.png?raw=true" /></p>

<p>Estos son los c√≥digos para la creaci√≥n de los dataframes:</p>

<p>R:</p>
<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_opp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">opportunity</span><span class="p">,</span><span class="n">team_penalty_cat</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">penalty_yards</span><span class="p">))</span><span class="w"> </span><span class="c1">#count</span><span class="w">

</span><span class="n">levels</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">df_opp</span><span class="o">$</span><span class="n">team_penalty_cat</span><span class="p">))</span><span class="w">  

</span></code></pre></div></div>

<p>Python:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df_opp</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">"opportunity"</span><span class="p">,</span><span class="s">"team_penalty_cat"</span><span class="p">])[</span><span class="s">"penalty_yards"</span><span class="p">].</span><span class="nb">sum</span><span class="p">().</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"count_yds"</span><span class="p">)</span>
<span class="n">df_opp</span><span class="p">.</span><span class="n">opportunity</span> <span class="o">=</span> <span class="n">df_opp</span><span class="p">.</span><span class="n">opportunity</span><span class="p">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</code></pre></div></div>

<p>Si bien son muy sencillos los dataframes, en <strong>ggplot</strong> tuve que poner definir los levels del campo <code class="language-plaintext highlighter-rouge">team_penalty_cat</code> para poder hacer la gr√°fica.</p>

<p>La gr√°fica de R sali√≥ con este c√≥digo:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plot_opp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ggplot</span><span class="p">(</span><span class="n">df_opp</span><span class="p">,</span><span class="w">
                     </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">opportunity</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">count</span><span class="p">,</span><span class="w">
                         </span><span class="n">fill</span><span class="o">=</span><span class="n">team_penalty_cat</span><span class="w">
                         </span><span class="c1">#fill=factor(team_penalty_cat,levels=c("NE","Oponente"))</span><span class="w">
                         </span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">,</span><span class="w">
           </span><span class="n">position</span><span class="o">=</span><span class="s2">"stack"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">count</span><span class="p">),</span><span class="w">
            </span><span class="n">position</span><span class="o">=</span><span class="n">position_stack</span><span class="p">(</span><span class="n">vjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.5</span><span class="p">),</span><span class="w">
            </span><span class="n">family</span><span class="o">=</span><span class="s2">"mono"</span><span class="p">,</span><span class="w">
            </span><span class="n">color</span><span class="o">=</span><span class="s2">"#FFFFFF"</span><span class="p">,</span><span class="w">
            </span><span class="n">size</span><span class="o">=</span><span class="m">3.5</span><span class="w">
            </span><span class="p">)</span><span class="o">+</span><span class="w"> 
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Oportunidad"</span><span class="p">)</span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Yardas Concedidas\nPor Equipo y Oportunidad - ggplot"</span><span class="p">,</span><span class="w">
       </span><span class="n">subtitle</span><span class="o">=</span><span class="s2">"Incluye Castigos Ofensivos y Defensivos"</span><span class="p">,</span><span class="w">
       </span><span class="n">caption</span><span class="o">=</span><span class="s2">"@nerudista"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">guides</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">guide_legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">NULL</span><span class="p">))</span><span class="o">+</span><span class="w">      </span><span class="c1">#remove legend title</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"#08415C"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#B0B7BC"</span><span class="p">))</span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_discrete</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="kc">NULL</span><span class="p">)</span><span class="o">+</span><span class="w">
  
  </span><span class="n">theme_pats_white</span><span class="o">+</span><span class="w">
  </span><span class="n">theme</span><span class="p">(</span><span class="w">
    </span><span class="n">axis.title.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">element_blank</span><span class="p">()</span><span class="w">
  </span><span class="p">);</span><span class="w"> </span><span class="n">plot_opp</span><span class="w">

</span></code></pre></div></div>
<p>La secuencia de pasos de <strong>ggplot</strong> fue:</p>

<ol>
  <li>Definir los aes() de la gr√°fica.</li>
  <li>Crear la gr√°fica de barra.</li>
  <li>Sobre la anterior crear la gr√°fica para los textos arriba de las barras.</li>
  <li>Girar la gr√°fica para hacer las barras horizontales.</li>
</ol>

<p>Aqu√≠ el truco est√° en <code class="language-plaintext highlighter-rouge">position="stack"</code> para hacer el apilado y en <code class="language-plaintext highlighter-rouge">coord_flip()</code> para hacer las barras horizontales. Tambi√©n agregu√© un subt√≠tulo con <code class="language-plaintext highlighter-rouge">subtitle="Incluye Castigos Ofensivos y Defensivos"</code>.</p>

<p>Para <strong>Altair</strong> el c√≥digo fue:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">bars_opp</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_opp</span><span class="p">).</span><span class="n">mark_bar</span><span class="p">().</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">'count_yds:Q'</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s">'zero'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Y</span> <span class="p">(</span><span class="s">"opportunity:N"</span> <span class="p">,</span> 
           <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">"Oportunidad"</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Color</span><span class="p">(</span><span class="s">'team_penalty_cat'</span> <span class="p">,</span> 
                    <span class="n">legend</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Legend</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s">"horizontal"</span><span class="p">,</span>
                                      <span class="n">orient</span><span class="o">=</span><span class="s">"none"</span><span class="p">,</span>
                                      <span class="n">legendX</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
                                      <span class="n">legendY</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span>
                                      <span class="n">columnPadding</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                      <span class="n">padding</span><span class="o">=-</span><span class="mi">25</span><span class="p">,</span>
                                     <span class="p">))</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
  <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">text_opp</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df_opp</span><span class="p">).</span><span class="n">mark_text</span><span class="p">(</span><span class="n">dx</span><span class="o">=-</span><span class="mi">25</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'white'</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s">"Courier"</span><span class="p">,</span>
    <span class="n">fontSize</span><span class="o">=</span><span class="mi">12</span><span class="p">,).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">X</span><span class="p">(</span><span class="s">'count_yds:Q'</span><span class="p">,</span> <span class="n">stack</span><span class="o">=</span><span class="s">'zero'</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="bp">None</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Y</span><span class="p">(</span><span class="s">'opportunity:N'</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">EncodingSortField</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s">"opportunity"</span><span class="p">,</span>
                                                        <span class="c1">#op="argmax",
</span>                                                        <span class="n">order</span><span class="o">=</span><span class="s">'ascending'</span><span class="p">)),</span>
    <span class="n">detail</span><span class="o">=</span><span class="s">'team_penalty_cat:N'</span><span class="p">,</span>
    <span class="n">text</span><span class="o">=</span><span class="n">alt</span><span class="p">.</span><span class="n">Text</span><span class="p">(</span><span class="s">'count_yds:Q'</span><span class="p">)</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
  <span class="n">width</span> <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
  <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">base_opp</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">layer</span><span class="p">(</span><span class="n">bars_opp</span><span class="p">,</span><span class="n">text_opp</span><span class="p">)</span>

<span class="n">subtitle</span> <span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">Chart</span><span class="p">(</span>
    <span class="p">{</span><span class="s">"values"</span><span class="p">:</span> <span class="p">[{</span><span class="s">"text"</span><span class="p">:</span> <span class="s">"Incluye Castigos Ofensivos y Defensivos"</span><span class="p">}]}</span>
<span class="p">).</span><span class="n">mark_text</span><span class="p">(</span><span class="n">dx</span><span class="o">=-</span><span class="mi">165</span> <span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">"#08415C"</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="s">'Courier'</span><span class="p">).</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s">"text:N"</span>
<span class="p">).</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">width</span> <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="n">subtitle</span>

<span class="n">final_opp</span><span class="o">=</span> <span class="n">alt</span><span class="p">.</span><span class="n">vconcat</span><span class="p">(</span><span class="c1">#title, 
</span>             <span class="n">subtitle</span><span class="p">,</span>
             <span class="n">base_opp</span><span class="p">,</span>
             <span class="n">caption_chart</span><span class="p">).</span><span class="n">properties</span><span class="p">(</span>
   <span class="n">title</span><span class="o">=</span><span class="s">"Castigos de Contrarios en los 5 min Finales"</span>  <span class="p">)</span>

<span class="n">final_opp</span>

<span class="c1">#Guardar imagen
</span><span class="n">final_opp</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">'./graficas/Altair/AltairYardasOportunidad.png'</span><span class="p">,</span> <span class="n">scale_factor</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
</code></pre></div></div>

<p>La  l√≥gica aqu√≠ fue:</p>

<ol>
  <li>Crear chart.</li>
  <li>Crear la gr√°fica de barra.</li>
  <li>Crear otra gr√°fica para los textos arriba de las barras.</li>
  <li>Hacer una <em>layer chart</em> para unir las dos anteriores.</li>
  <li>Crear una gr√°fica para el <em>caption</em>.</li>
  <li>Crear una gr√°fica para el <em>subtitle</em>.</li>
  <li>Concatenar verticalmente la <em>layer chart</em> con el <em>caption</em> y el <em>subtitle</em></li>
</ol>

<p>Nuevamente tuve problemas con el eje Y y no pude quitar la l√≠nea vertical. Intent√© centrar los labels dentro de las barras pero no lo logr√© adem√°s de que no logr√© ordenar las oportunidades en el eje Y de la misma forma que en <strong>ggplot</strong>.</p>

<p>Un punto importante es el subtitle lo hice concatenando verticalmente otra gr√°fica. Sin embargo, cuando lo hago me queda por arriba del <em>legend</em>. Intent√© jugar de varias maneras con la posici√≥n X y Y del <em>legend</em> pero no logr√© poner el subt√≠tulo entre el t√≠tulo y la gr√°fica. Se aceptan sugerencias.</p>

<p>Hacer ambas gr√°ficas fue relativamente r√°pido. En <strong>ggplot</strong> basta con hacer el <code class="language-plaintext highlighter-rouge">coord_flip()</code>y en Altair es a√∫n m√°s f√°cil pues basta con indicar en qu√© eje queremos cada variable.</p>

<p>Hacer gr√°ficas simples es bastante f√°cil con ambas #bibliotecasNoLibrerias pero las horas de investigaci√≥n se van en los detallitos: ejes, leyendas, posiciones, espacios entre barras, orientaci√≥n de las etiquetas, etc.</p>

<h2 id="y-nom√°s-dos-gr√°ficas">¬øY nom√°s dos gr√°ficas?</h2>

<p>No. tengo otras tres un poquito m√°s interesante pero para no hacer m√°s largo este art√≠culo y para darle m√°s carnita al blog del amigo @tacosdedatos , las siguientes gr√°ficas vienen en la segunda parte de esta entrega.</p>

<p>Est√©n atentos a su publicaci√≥n que esto apenas empieza.</p>

<hr />

<p>¬øQu√© te pareci√≥ la nota? <a href="https://twitter.com/share?text=Obvio+que+estuvo+super+el+blog+%40tacosdedatos+%F0%9F%8C%AE">Mandanos un tuit a @tacosdedatos</a> o <a href="https://twitter.com/share?text=Obvio+que+estuvo+super+el+blog+%40tacosdedatos+y+%40nerudista+%F0%9F%8C%AE">a @nerudista</a> o envianos un correo a <a href="mailto:sugerencias@tacosdedatos.com?subject=Sugerencia&amp;body=Hola-holaaa">‚úâÔ∏è sugerencias@tacosdedatos.com</a>. Y recuerda que puedes subscribirte a nuestro bolet√≠n semanal aqu√≠ debajo.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            
                <section class="subscribe-form">
                    <h3 class="subscribe-form-title">Subscr√≠bete a üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol.</h3>
                    <p>Recibe las mejores publicaciones directamente a tu caja de entrada</p>
                    <div id="revue-embed">
  <form
    action="http://boletin.tacosdedatos.com/add_subscriber"
    method="post"
    id="revue-form"
    name="revue-form"
    target="_blank"
  >
    <div class="revue-form-group">
      <div>
        <label for="member_email">Correo electr√≥nico</label>
        <input
          class="revue-form-field"
          placeholder="Tu correo electr√≥nico"
          type="email"
          name="member[email]"
          id="member_email"
        />
      </div>
      <div class="revue-form-group">
        <label for="member_first_name"
          >Nombre <span class="optional">(Opcional)</span></label
        >
        <input
          class="revue-form-field"
          placeholder="Nombre (opcional)"
          type="text"
          name="member[first_name]"
          id="member_first_name"
        />
      </div>
      <div class="revue-form-group">
        <label for="member_last_name"
          >Apellidos <span class="optional">(Opcional)</span></label
        >
        <input
          class="revue-form-field"
          placeholder="Apellidos (opcional)"
          type="text"
          name="member[last_name]"
          id="member_last_name"
        />
      </div>
      <div class="revue-form-actions">
        <input
          type="submit"
          value="Subscribe"
          name="member[subscribe]"
          id="member_submit"
        />
      </div>
    </div>
    <div class="revue-form-footer">
      Al registrarte declaras aceptar los
      <a target="_blank" href="https://www.getrevue.co/terms"
        >t√©rminos y condiciones de uso</a
      >
      y la
      <a target="_blank" href="https://www.getrevue.co/privacy"
        >pol√≠tica de privacidad</a
      >
      de Revue.
    </div>
  </form>
</div>

                </section>
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        <section class="author-card">
                            
                                <img class="author-profile-image" src="/assets/images/yo_nerudista.jpg" alt="nerudista" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/nerudista">Pablo Quetzalc√≥atl V√°zquez</a></h4>
                                
                                    <p>Me encantan los datos y los deportes. Aprendiz eterno de BI, Dataviz y ahora de Python y R. Tambi√©n entrenador de Triatl√≥n por si ocupan.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/nerudista">Lee M√°s</a>
                        </div>
                    
                
                    
                
                    
                
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            
                <section class="post-full-comments">
                    <div id="disqus_thread"></div>
                    <script>
                        var disqus_config = function () {
                            this.page.url = 'https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair';
                            this.page.identifier = 'Primeros pasos con ggplot (R) y Altair (Python)';
                        };
                        (function() {
                            var d = document, s = d.createElement('script');
                            s.src = 'https://tacosdedatos.disqus.com/embed.js';
                            s.setAttribute('data-timestamp', +new Date());
                            (d.head || d.body).appendChild(s);
                        })();
                    </script>
                </section>
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
                    <article class="read-next-card"
                        
                            style="background-image: url(/assets/images/blog-cover.png)"
                        
                    >
                        <header class="read-next-card-header">
                            <small class="read-next-card-header-sitetitle">&mdash; üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol. &mdash;</small>
                            
                                <h3 class="read-next-card-header-title"><a href="/tag/blog/">Blog</a></h3>
                            
                        </header>
                        <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
</div>
                        <div class="read-next-card-content">
                            <ul>
                                
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/sidetable-el-beffo-de-pandas">Sidetable, el beffo de pandas</a></li>
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/Dueno-de-mis-Datos-Facebook-Parte-III">Due√±o de mis datos - Cap√≠tulo Facebook - Parte III</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                            <li><a href="/Dueno-de-mis-Datos-Facebook-Parte-II">Due√±o de mis datos - Cap√≠tulo Facebook - Parte II</a></li>
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                
                                  
                                    
                                        
                                        
                                    
                                  
                                
                                  
                                
                            </ul>
                        </div>
                        <footer class="read-next-card-footer">
                            <a href="/tag/blog/">
                                
                                    See all 22 posts  ‚Üí
                                
                            </a>
                        </footer>
                    </article>
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/Primeros-pasos-con-ggplot-y-altair-Parte-II">
                <div class="post-card-image" style="background-image: url(/assets/blogposts/010.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/Primeros-pasos-con-ggplot-y-altair-Parte-II">
                <header class="post-card-header">
                    
                        
                            
                               <span class="post-card-tags">Blog</span>
                            
                        
                            
                               <span class="post-card-tags">Altair</span>
                            
                        
                            
                               <span class="post-card-tags">Ggplot2</span>
                            
                        
                            
                               <span class="post-card-tags">Python</span>
                            
                        
                            
                                <span class="post-card-tags">R</span>
                            
                        
                    

                    <h2 class="post-card-title">Primeros pasos con ggplot (R) y Altair (Python) - Parte II</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/yo_nerudista.jpg" alt="Pablo Quetzalc√≥atl V√°zquez" />
                        
                        <span class="post-card-author">
                            <a href="/author/nerudista/">Pablo Quetzalc√≥atl V√°zquez</a>
                        </span>
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                
    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/Visualizando-comparaciones-de-proporciones">
                <div class="post-card-image" style="background-image: url(/assets/blogposts/008.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/Visualizando-comparaciones-de-proporciones">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Blog</span>
                            
                        
                    

                    <h2 class="post-card-title">Visualizando Comparaciones de Proporciones</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/yo.jpg" alt="Sergio S√°nchez Zavala" />
                        
                        <span class="post-card-author">
                            <a href="/author/sergio/">Sergio S√°nchez Zavala</a>
                        </span>
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
        <a href="https://old.tacosdedatos.com/">
            
                <img src="/assets/icons/favicon.ico" alt="üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol. icon" />
            
            <span>üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol.</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Primeros pasos con ggplot (R) y Altair (Python)</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">comparte esto <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Primeros+pasos+con+ggplot+%28R%29+y+Altair+%28Python%29&amp;url=https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://old.tacosdedatos.com/Primeros-pasos-con-ggplot-y-altair"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="https://old.tacosdedatos.com/">üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol.</a> &copy; 2021</section>
                <section class="poweredby">Publicado con <a href="https://jekyllrb.com/">Jekyll</a>, c√≥digo abierto en 
                    <a href="https://github.com/tacosdedatos/website" target="_blank" rel="noopener">GitHub</a> usando
                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>
                <nav class="site-footer-nav">
                    <a href="/">lo <b>+</b> nuevo</a>
                    <a href="https://tacosdedatos.com/etiquetas" target="_blank" rel="noopener">etiquetas</a>
                    <!-- <a href="https://facebook.com/tacosdedatos" target="_blank" rel="noopener">Facebook</a> -->
                    <!-- <a href="https://twitter.com/tacosdedatos" target="_blank" rel="noopener">Twitter</a> -->
                    <a href="https://instagram.com/chekos.visuals" target="_blank" rel="noopener">instagram</a>
                    
                    <a href="https://join.slack.com/t/tacosdedatos/shared_invite/enQtNTQyOTE3NzE5NDE1LTA2MWZhMGE3NzNhYTA0Yjc1Yjk0NTZjNzM4M2VjOGIzOTA4YTc2ZjlkYjIyODRmYjA0MjVlMjExNjRjYWQ0NDQ" target="_blank" rel="noopener">slack</a>
                    <a href="https://patreon.com/tacosdedatos/" target="_blank" rel="noopener">patreon</a>
                </nav>
            </div>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                    <img class="subscribe-overlay-logo" src="/assets/images/alt-blog-icon.png" alt="üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol." />
                
                <h1 class="subscribe-overlay-title">Subscr√≠bete a üåÆ tacos de datos | Aprende visualizaci√≥n de datos en espa√±ol.</h1>
                <p class="subscribe-overlay-description">¬°Mantente al tanto! Recibe las mejores publicaciones directamente a tu caja de entrada.</p>
                <div id="revue-embed">
  <form
    action="http://boletin.tacosdedatos.com/add_subscriber"
    method="post"
    id="revue-form"
    name="revue-form"
    target="_blank"
  >
    <div class="revue-form-group">
      <div>
        <label for="member_email">Correo electr√≥nico</label>
        <input
          class="revue-form-field"
          placeholder="Tu correo electr√≥nico"
          type="email"
          name="member[email]"
          id="member_email"
        />
      </div>
      <div class="revue-form-group">
        <label for="member_first_name"
          >Nombre <span class="optional">(Opcional)</span></label
        >
        <input
          class="revue-form-field"
          placeholder="Nombre (opcional)"
          type="text"
          name="member[first_name]"
          id="member_first_name"
        />
      </div>
      <div class="revue-form-group">
        <label for="member_last_name"
          >Apellidos <span class="optional">(Opcional)</span></label
        >
        <input
          class="revue-form-field"
          placeholder="Apellidos (opcional)"
          type="text"
          name="member[last_name]"
          id="member_last_name"
        />
      </div>
      <div class="revue-form-actions">
        <input
          type="submit"
          value="Subscribe"
          name="member[subscribe]"
          id="member_submit"
        />
      </div>
    </div>
    <div class="revue-form-footer">
      Al registrarte declaras aceptar los
      <a target="_blank" href="https://www.getrevue.co/terms"
        >t√©rminos y condiciones de uso</a
      >
      y la
      <a target="_blank" href="https://www.getrevue.co/privacy"
        >pol√≠tica de privacidad</a
      >
      de Revue.
    </div>
  </form>
</div>

            </div>
        </div>
    

    <!-- highlight.js -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script> -->
    <script src="/assets/js/highlight.pack.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('pre code').forEach((block) => {
            hljs.highlightBlock(block);
        });
    });
    </script>
    <!-- prism.js -->
    <!-- <script type="text/javascript" src="/assets/js/prism.js"></script> -->
    

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>

    <!-- <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script> -->


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-133541532-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
